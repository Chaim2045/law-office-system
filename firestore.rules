rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // ✅ Allow authenticated users to READ their own employee document
    match /employees/{employeeId} {
      allow read: if request.auth != null &&
                     resource.data.authUID == request.auth.uid;
      allow write: if false; // Only through Functions
    }

    // ✅ Allow authenticated users to READ clients (they need this for dropdowns)
    match /clients/{clientId} {
      allow read: if request.auth != null;
      allow write: if false; // Only through Functions
    }

    // ✅ Allow authenticated users to READ cases (new architecture)
    match /cases/{caseId} {
      allow read: if request.auth != null;
      allow write: if false; // Only through Functions
    }

    // ✅ Allow authenticated users to READ their own tasks
    match /budget_tasks/{taskId} {
      allow read: if request.auth != null;
      allow write: if false; // Only through Functions
    }

    // ✅ Allow authenticated users to READ their own timesheet entries
    match /timesheet_entries/{entryId} {
      allow read: if request.auth != null;
      allow write: if false; // Only through Functions
    }

    // ✅ Allow reading audit logs (admin only in future)
    match /audit_log/{logId} {
      allow read: if request.auth != null;
      allow write: if false; // Only through Functions
    }

    // ✅ Allow reading user tracking data
    match /user_tracking/{trackingId} {
      allow read: if request.auth != null;
      allow write: if false; // Only through Functions
    }

    // ❌ Deny all other collections by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
