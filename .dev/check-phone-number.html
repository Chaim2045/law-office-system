<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×“×™×§×ª ××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×‘××¢×¨×›×ª</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .result {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            border-right: 4px solid #4CAF50;
        }
        .result pre {
            background: #2d2d2d;
            color: #fff;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background: #45a049;
        }
        input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 10px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ×‘×“×™×§×ª ××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×‘××¢×¨×›×ª</h1>

        <label for="phoneInput">×”×›× ×¡ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ:</label>
        <input type="tel" id="phoneInput" value="+972549539238" placeholder="×œ××©×œ: +972549539238 ××• 0549539238">

        <button onclick="checkPhone()">×‘×“×•×§ ××¡×¤×¨</button>

        <div id="result"></div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, doc, updateDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDxSXW6r1PU-OqZz8kJYVp6t92dvMXCJ3Q",
            authDomain: "law-office-system-e4801.firebaseapp.com",
            projectId: "law-office-system-e4801",
            storageBucket: "law-office-system-e4801.firebasestorage.app",
            messagingSenderId: "746166583616",
            appId: "1:746166583616:web:3a3c7098e0c3d3e8e80f60"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.checkPhone = async function() {
            const phoneInput = document.getElementById('phoneInput').value.trim();
            const resultDiv = document.getElementById('result');

            if (!phoneInput) {
                resultDiv.innerHTML = '<div class="status error">âŒ ×× × ×”×›× ×¡ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ</div>';
                return;
            }

            // × ×¨××•×œ ×”××¡×¤×¨
            let cleanPhone = phoneInput.replace(/\D/g, '');

            // ×”×¡×¨ +972 ×× ×§×™×™×
            if (cleanPhone.startsWith('972')) {
                cleanPhone = cleanPhone.substring(3);
            }

            // ×”×¡×¨ 0 ××”×ª×—×œ×” ×× ×§×™×™×
            if (cleanPhone.startsWith('0')) {
                cleanPhone = cleanPhone.substring(1);
            }

            resultDiv.innerHTML = '<div class="status">ğŸ”„ ××—×¤×© ×‘××¢×¨×›×ª...</div>';

            try {
                // ×—×™×¤×•×© ×›×œ ×”×¢×•×‘×“×™×
                const employeesSnapshot = await getDocs(collection(db, 'employees'));

                let foundUser = null;
                let allUsers = [];

                employeesSnapshot.forEach((doc) => {
                    const data = doc.data();
                    const userPhone = (data.phone || '').replace(/\D/g, '');

                    allUsers.push({
                        id: doc.id,
                        name: data.name,
                        email: data.email,
                        phone: data.phone,
                        role: data.role,
                        phoneClean: userPhone
                    });

                    // ×‘×“×™×§×” ×× ×–×” ×”××¡×¤×¨
                    if (userPhone.endsWith(cleanPhone) || cleanPhone.endsWith(userPhone.substring(userPhone.length - 9))) {
                        foundUser = {
                            id: doc.id,
                            ...data
                        };
                    }
                });

                if (foundUser) {
                    const isAdmin = foundUser.role === 'admin';
                    const statusClass = isAdmin ? 'success' : 'warning';

                    resultDiv.innerHTML = `
                        <div class="result">
                            <h2>âœ… ××©×ª××© × ××¦×!</h2>
                            <p><strong>ğŸ”‘ ××–×”×”:</strong> ${foundUser.id}</p>
                            <p><strong>ğŸ‘¤ ×©×:</strong> ${foundUser.name || '×œ× ×¦×•×™×Ÿ'}</p>
                            <p><strong>ğŸ“§ ××™××™×™×œ:</strong> ${foundUser.email}</p>
                            <p><strong>ğŸ“± ×˜×œ×¤×•×Ÿ ×‘××¢×¨×›×ª:</strong> ${foundUser.phone || '×œ× ×¦×•×™×Ÿ'}</p>
                            <p><strong>ğŸ­ ×ª×¤×§×™×“:</strong> ${foundUser.role || '×œ× ×¦×•×™×Ÿ'}</p>

                            <div class="status ${statusClass}" style="margin-top: 20px;">
                                ${isAdmin
                                    ? '<strong>âœ… ×”××©×ª××© ×”×•× Admin</strong><br>×”×‘×•×˜ ×××•×¨ ×œ×¢×‘×•×“!'
                                    : '<strong>âš ï¸ ×”××©×ª××© ×œ× Admin!</strong><br>×”×‘×•×˜ ×œ× ×™×¢× ×” ×œ××¡×¤×¨ ×–×”.<br>×¦×¨×™×š ×œ×©× ×•×ª ××ª role ×œ-"admin"'
                                }
                            </div>

                            <h3 style="margin-top: 20px;">ğŸ“„ JSON ×”××œ×:</h3>
                            <pre>${JSON.stringify(foundUser, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="status error">
                            <strong>âŒ ×”××¡×¤×¨ ×œ× × ××¦× ×‘××¢×¨×›×ª!</strong><br><br>
                            ×—×™×¤×©× ×•: ${cleanPhone}<br>
                            ××¡×¤×¨ ××©×ª××©×™× ×‘××¢×¨×›×ª: ${allUsers.length}<br><br>
                            <strong>×¨×©×™××ª ×›×œ ×”××¡×¤×¨×™× ×‘××¢×¨×›×ª:</strong>
                        </div>
                        <div class="result">
                            <pre>${JSON.stringify(allUsers.map(u => ({
                                name: u.name,
                                phone: u.phone,
                                role: u.role
                            })), null, 2)}</pre>
                        </div>
                    `;
                }

            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = `<div class="status error">âŒ ×©×’×™××”: ${error.message}</div>`;
            }
        };

        // ×‘×“×™×§×” ××•×˜×•××˜×™×ª ×‘×˜×¢×™× ×”
        window.addEventListener('load', () => {
            setTimeout(() => {
                window.checkPhone();
            }, 500);
        });
    </script>
</body>
</html>
