<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>בדיקת createdAt</title>
</head>
<body>
    <h1>בדיקת שדה createdAt במשימות pending</h1>
    <pre id="output"></pre>

    <script>
        const output = document.getElementById('output');

        // הדבק בקונסול:
        const code = `
(async function() {
    const db = window.firebaseDB;

    console.log('🔍 בדיקת שדה createdAt במשימות pending...\\n');

    const pending = await db.collection('pending_task_approvals')
        .where('status', '==', 'pending')
        .get();

    console.log(\`נמצאו \${pending.size} משימות pending\\n\`);

    const results = [];

    pending.forEach(doc => {
        const data = doc.data();

        results.push({
            id: doc.id.substring(0, 10),
            requestedBy: data.requestedByName || data.requestedBy,
            client: data.taskData?.clientName,
            hasCreatedAt: !!data.createdAt,
            createdAt: data.createdAt ? 'YES' : 'MISSING ❌',
            createdAtType: data.createdAt ? typeof data.createdAt : 'N/A',
            createdAtValue: data.createdAt ? data.createdAt.toDate().toISOString() : 'N/A'
        });
    });

    console.table(results);

    // ספירה
    const withCreatedAt = results.filter(r => r.hasCreatedAt).length;
    const withoutCreatedAt = results.filter(r => !r.hasCreatedAt).length;

    console.log(\`\\n📊 סיכום:\`);
    console.log(\`   ✅ עם createdAt: \${withCreatedAt}\`);
    console.log(\`   ❌ בלי createdAt: \${withoutCreatedAt}\`);

    if (withoutCreatedAt > 0) {
        console.log(\`\\n⚠️ זו הבעיה!\\n\`);
        console.log('המשימות ללא createdAt לא יופיעו ב-Query עם orderBy');
        console.log('\\n💡 פתרון: צריך להוסיף createdAt למשימות הקיימות');
    }
})();
        `;

        output.textContent = `הדבק את הקוד הזה בקונסול של האדמין פאנל:\n\n${code}`;
    </script>
</body>
</html>
