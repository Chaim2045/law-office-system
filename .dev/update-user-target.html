<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>×¢×“×›×•×Ÿ ×ª×§×Ÿ ×©×¢×•×ª</title>
</head>
<body>
<h1>×¢×“×›×•×Ÿ ×ª×§×Ÿ ×©×¢×•×ª ×œ××©×ª××©</h1>
<p>×¡×§×¨×™×¤×˜ ×–×” ×™×¢×“×›×Ÿ ××ª ×ª×§×Ÿ ×”×©×¢×•×ª ×”×™×•××™ ×¢×‘×•×¨ ×”××©×ª××© haim@ghlawoffice.co.il</p>

<div id="status"></div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-functions-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

<script>
// Firebase Configuration
const firebaseConfig = {
  apiKey: "AIzaSyBN8PsuM2wCm0eeUmWZ7TfiHTw0zXN2OQo",
  authDomain: "law-office-system-e4801.firebaseapp.com",
  projectId: "law-office-system-e4801",
  storageBucket: "law-office-system-e4801.firebasestorage.app",
  messagingSenderId: "574608275476",
  appId: "1:574608275476:web:c869ad4c5b8f20fe8c6607"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const functions = firebase.functions();

async function updateUserTarget() {
    const statusDiv = document.getElementById('status');

    try {
        statusDiv.innerHTML = '<p>â³ ××ª×—×‘×¨ ×œ-Firestore...</p>';

        // ×§×¨×™××” ×™×©×™×¨×” ×œ-Firestore (×œ×œ× Cloud Function)
        const userEmail = 'haim@ghlawoffice.co.il';
        const dailyTarget = 10;

        statusDiv.innerHTML += '<p>ğŸ“ ××¢×“×›×Ÿ ××©×ª××©: ' + userEmail + '</p>';
        statusDiv.innerHTML += '<p>ğŸ¯ ×ª×§×Ÿ ×—×“×©: ' + dailyTarget + ' ×©×¢×•×ª/×™×•×</p>';

        // ×¢×“×›×•×Ÿ ×™×©×™×¨ ×‘-Firestore
        await db.collection('employees').doc(userEmail).update({
            dailyHoursTarget: dailyTarget,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        statusDiv.innerHTML += '<p style="color: green;">âœ… ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”!</p>';

        // ××™××•×ª
        statusDiv.innerHTML += '<p>ğŸ” ××××ª...</p>';
        const doc = await db.collection('employees').doc(userEmail).get();
        const data = doc.data();

        statusDiv.innerHTML += '<p>ğŸ“Š ×ª×§×Ÿ ×©×¢×•×ª ×™×•××™: <strong>' + (data.dailyHoursTarget || '×œ× ××•×’×“×¨') + '</strong></p>';

        if (data.dailyHoursTarget === dailyTarget) {
            statusDiv.innerHTML += '<p style="color: green; font-weight: bold;">âœ… ×”××™××•×ª ×”×¦×œ×™×—! ×”×ª×§×Ÿ ×¢×•×“×›×Ÿ ×œ-' + dailyTarget + ' ×©×¢×•×ª</p>';
        } else {
            statusDiv.innerHTML += '<p style="color: red;">âŒ ×”××™××•×ª × ×›×©×œ - ×”×¢×¨×š ×œ× ×”×ª×¢×“×›×Ÿ</p>';
        }

    } catch (error) {
        statusDiv.innerHTML += '<p style="color: red;">âŒ ×©×’×™××”: ' + error.message + '</p>';
        console.error('Full error:', error);
    }
}

// ×”×¨×¥ ××ª ×”×¢×“×›×•×Ÿ
updateUserTarget();
</script>
</body>
</html>
