<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>בדיקת נתונים אמיתיים</title>
</head>
<body>
    <h1>בדיקת נתונים אמיתיים מ-Firebase</h1>
    <div id="results"></div>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    
    <script>
        const db = firebase.firestore();
        const results = document.getElementById('results');
        
        async function checkData() {
            results.innerHTML = '<h2>🔍 בודק נתונים...</h2>';
            
            // 1. בדוק לקוחות ישנים (clients)
            const clientsSnapshot = await db.collection('clients').get();
            results.innerHTML += `<h3>📁 Clients Collection: ${clientsSnapshot.size} documents</h3>`;
            
            if (clientsSnapshot.size > 0) {
                results.innerHTML += '<h4>דוגמת לקוחות:</h4><ul>';
                clientsSnapshot.docs.slice(0, 5).forEach(doc => {
                    const data = doc.data();
                    results.innerHTML += `<li><strong>${doc.id}</strong>: ${data.fullName || data.clientName || 'שם לא ידוע'}</li>`;
                });
                results.innerHTML += '</ul>';
            }
            
            // 2. בדוק תיקים חדשים (cases)
            const casesSnapshot = await db.collection('cases').get();
            results.innerHTML += `<h3>📁 Cases Collection: ${casesSnapshot.size} documents</h3>`;
            
            if (casesSnapshot.size > 0) {
                results.innerHTML += '<h4>דוגמת תיקים:</h4><ul>';
                casesSnapshot.docs.slice(0, 5).forEach(doc => {
                    const data = doc.data();
                    results.innerHTML += `<li><strong>${doc.id}</strong>: ${data.caseTitle || 'כותרת לא ידועה'} - לקוח: ${data.clientName || 'לא ידוע'}</li>`;
                });
                results.innerHTML += '</ul>';
            }
            
            // 3. בדוק משימות תקצוב
            const tasksSnapshot = await db.collection('budget_tasks').get();
            results.innerHTML += `<h3>📁 Budget Tasks: ${tasksSnapshot.size} documents</h3>`;
            
            if (tasksSnapshot.size > 0) {
                results.innerHTML += '<h4>דוגמת משימות:</h4><ul>';
                tasksSnapshot.docs.slice(0, 5).forEach(doc => {
                    const data = doc.data();
                    results.innerHTML += `<li><strong>${data.description}</strong> - לקוח: ${data.clientName} (ID: ${data.clientId || 'N/A'}, Case ID: ${data.caseId || 'N/A'})</li>`;
                });
                results.innerHTML += '</ul>';
            }
            
            // 4. בדוק שעתון
            const timesheetSnapshot = await db.collection('timesheet_entries').get();
            results.innerHTML += `<h3>📁 Timesheet Entries: ${timesheetSnapshot.size} documents</h3>`;
            
            if (timesheetSnapshot.size > 0) {
                results.innerHTML += '<h4>דוגמת רשומות שעתון:</h4><ul>';
                timesheetSnapshot.docs.slice(0, 5).forEach(doc => {
                    const data = doc.data();
                    results.innerHTML += `<li><strong>${data.action}</strong> - לקוח: ${data.clientName} (${data.minutes} דקות)</li>`;
                });
                results.innerHTML += '</ul>';
            }
            
            // 5. סיכום - האם יש מיגרציה?
            results.innerHTML += '<hr><h2>📊 סיכום ארכיטקטורה:</h2>';
            results.innerHTML += `<p><strong>ארכיטקטורה ישנה (clients):</strong> ${clientsSnapshot.size} רשומות</p>`;
            results.innerHTML += `<p><strong>ארכיטקטורה חדשה (cases):</strong> ${casesSnapshot.size} רשומות</p>`;
            
            if (clientsSnapshot.size > 0 && casesSnapshot.size === 0) {
                results.innerHTML += '<p style="color: red;">⚠️ <strong>הבעיה:</strong> יש רק clients ישנים, אין cases חדשים. צריך מיגרציה!</p>';
            } else if (clientsSnapshot.size > 0 && casesSnapshot.size > 0) {
                results.innerHTML += '<p style="color: orange;">⚠️ <strong>מצב ביניים:</strong> יש גם clients וגם cases. ייתכן שהמיגרציה לא הושלמה.</p>';
            } else if (casesSnapshot.size > 0) {
                results.innerHTML += '<p style="color: green;">✅ <strong>ארכיטקטורה חדשה:</strong> המערכת עובדת עם cases בלבד.</p>';
            }
        }
        
        checkData().catch(err => {
            results.innerHTML += `<p style="color: red;">❌ שגיאה: ${err.message}</p>`;
            console.error(err);
        });
    </script>
</body>
</html>
