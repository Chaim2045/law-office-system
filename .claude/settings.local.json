{
  "systemPrompt": "âš ï¸ BRANCH WORKFLOW - CRITICAL:\n\nğŸŸ¡ DEFAULT BRANCH: main (DEVELOPMENT/TESTING)\n- ALWAYS work on 'main' branch by default!\n- Safe to commit and push to main\n- Goes to preview only: https://main--gh-law-office-system.netlify.app\n- Real users DO NOT see changes on main\n\nğŸ”´ PRODUCTION DEPLOYMENT - ONLY WITH SPECIAL PROTOCOL:\n- Deploy to production ONLY when user provides the full deployment protocol\n- The protocol starts with: '×§×œ×•×“, ×¡×™×™×× ×• ×¢× ×”×¢×‘×•×“×”'\n- If user does NOT provide this protocol â†’ work on main only\n- If user DOES provide this protocol â†’ follow it step-by-step to deploy to production\n- Production sites: https://gh-law-office-system.netlify.app & https://admin-gh-law-office-system.netlify.app\n\nâš ï¸ CRITICAL RULES:\n1. Work on main by default (goes to preview only)\n2. NEVER deploy to production without the full protocol message\n3. When you see the protocol â†’ follow every step carefully\n4. The protocol includes commit analysis, file review, and user approval\n5. When in doubt, stay on main!\n\nSee README-FOR-CLAUDE.md and DEPLOYMENT-WORKFLOW.md for details",
  "permissions": {
    "allow": [
      "Bash(mkdir:*)",
      "Bash(xcopy:*)",
      "Bash(nul)",
      "Bash(findstr:*)",
      "Bash(cp:*)",
      "Bash(rm:*)",
      "Bash(npm run dev:*)",
      "Bash(npm run build:*)",
      "Bash(npm install)",
      "Bash(npm install:*)",
      "Bash(node check-clients.js:*)",
      "Bash(git merge:*)",
      "Bash(netlify deploy:*)",
      "Bash(firebase login:list:*)",
      "Bash(firebase use:*)",
      "Bash(.claude/firestore-data/README.md)",
      "Bash(firebase firestore:indexes:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(git push:*)",
      "Bash(git reset:*)",
      "Bash(firebase functions:list:*)",
      "Bash(del \"c:\\Users\\haim\\law-office-system\\master-admin-panel\\debug-messaging.html\")",
      "Bash(del \"functions\\src\\messaging\\models\\Thread.js\")",
      "Bash(del \"functions\\src\\messaging\\services\\ThreadService.js\")",
      "Bash(del \"functions\\src\\messaging\\handlers\\threadHandlers.js\")",
      "Bash(dir:*)",
      "Bash(grep:*)",
      "Bash(find:*)",
      "Bash(for:*)",
      "Bash(do echo \"=== $file ===\")",
      "Bash(done)",
      "Bash(firebase deploy:*)",
      "Bash(firebase firestore:collections:*)",
      "Bash(firebase firestore:databases:*)",
      "Bash(node check-firestore-data.js:*)",
      "Bash(node:*)",
      "Bash(ls:*)",
      "Bash(npm run test:*)",
      "Bash(del:*)",
      "Bash(netlify open:*)",
      "Bash(wc:*)",
      "Bash(firebase projects:list:*)",
      "Bash(firebase firestore:databases:list:*)",
      "Bash(gcloud config get-value:*)",
      "Bash(gcloud auth list:*)",
      "Bash(where:*)",
      "Bash(firebase --version:*)",
      "Bash(firebase apps:list:*)",
      "Bash(firebase apps:sdkconfig:*)",
      "Bash(netlify status:*)",
      "Bash(netlify open:site:*)",
      "Bash(netlify open:admin:*)",
      "Bash(gcloud projects describe:*)",
      "Bash(curl -s \"https://firebase.googleapis.com/v1beta1/projects/law-office-system-e4801\")",
      "Bash(cat:*)",
      "Bash(git fetch:*)",
      "Bash(netlify sites:list:*)",
      "Bash(curl:*)",
      "Bash(echo:*)",
      "Bash(python3 -m json.tool:*)",
      "Bash(netlify switch:*)",
      "Bash(npm run compile-ts:*)",
      "Bash(git check-ignore:*)",
      "Bash(git log:*)",
      "Bash(git branch:*)",
      "Bash(netlify unlink:*)",
      "Bash(netlify link:*)",
      "Bash(firebase functions:delete:*)",
      "Bash(tree:*)",
      "Bash(git checkout:*)",
      "Bash(git revert:*)",
      "Bash(git cherry-pick:*)",
      "Bash(firebase functions:config:get:*)",
      "Bash(firebase functions:log:*)",
      "Bash(firebase firestore:get:*)",
      "Bash(Select-Object -Last 50)",
      "Bash(firebase firestore:indexes:list:*)",
      "Bash(netlify watch:*)",
      "Bash(firebase hosting:channel:list:*)",
      "Bash(start http://localhost:5000/check-last-message.html)",
      "Bash(start http://localhost:5000/test-notification-bell.html)",
      "Bash(npm run:*)",
      "Bash(firebase login:*)",
      "Bash(export GOOGLE_APPLICATION_CREDENTIALS=\"/c/Users/User/law-office-system/service-account-key.json\")",
      "Bash(GOOGLE_APPLICATION_CREDENTIALS=\"./service-account-key.json\" firebase deploy:*)",
      "Bash(firebase logout:*)",
      "Bash(npx tsc:*)",
      "Bash(chmod:*)",
      "Bash(firebase functions:secrets:set:*)",
      "Bash(firebase functions:config:set:*)",
      "Bash(git pull:*)",
      "Bash(firebase serve:*)",
      "Bash(gcloud functions logs read:*)",
      "Bash(git show:*)",
      "Bash(npx stylelint:*)",
      "Bash(do echo \"=== $hash ===\")",
      "Bash(git restore:*)",
      "Bash(Select-Object -Last 30)",
      "Bash(gcloud firestore documents list:*)",
      "Bash(GOOGLE_APPLICATION_CREDENTIALS=\"\" FIRESTORE_EMULATOR_HOST=\"\" node:*)",
      "Bash(firebase login:ci:*)",
      "Bash(gcloud functions deploy:*)",
      "Bash(clip:*)",
      "Bash(git diff:*)",
      "Bash(netlify api:*)",
      "Bash(git rev-parse:*)",
      "Bash(Select-Object -First 100)",
      "Bash(powershell -Command \"Compress-Archive -Path pdf-function\\* -DestinationPath pdf-function-deploy.zip -Force\")",
      "Bash(tar:*)",
      "Bash(start https://console.cloud.google.com/functions/list?project=law-office-system-e4801)",
      "Bash(start https://console.cloud.google.com/run?project=law-office-system-e4801)",
      "Bash(start https://console.firebase.google.com/project/law-office-system-e4801/functions)",
      "Bash(start \"https://console.cloud.google.com/functions/add?project=law-office-system-e4801\")",
      "Bash(powershell -Command \"[Convert]::ToBase64String([IO.File]::ReadAllBytes(''''images/logo.png''''))\")",
      "Bash(git commit -m \"$(cat <<''EOF''\nrefactor: Remove PDF Cloud Function, prepare for Print CSS\n\n×”×¡×¨×ª ×›×œ ×”×§×•×“ ×©×§×©×•×¨ ×œ-PDF Cloud Function:\n- ××—×™×§×ª ×§×‘×¦×™ Cloud Function (generateDailyPerformancePDF.js, pdfTemplate.js, logo.txt)\n- ×”×¡×¨×ª ×ª×œ×•×™×•×ª Puppeteer ×•-Chromium (77 ×—×‘×™×œ×•×ª)\n- ×”×¡×¨×ª export ×©×œ PDF function ×-functions/index.js\n- ×”×¡×¨×ª ×›×¤×ª×•×¨ PDF ××××©×§ ×”××©×ª××©\n- ×”×¡×¨×ª ×¤×•× ×§×¦×™×•×ª exportPerformancePDF ×•-base64ToBlob\n- ×”×¡×¨×ª event listeners ×©×œ PDF\n- ×”×¡×¨×ª ×¡×’× ×•× ×•×ª CSS ×©×œ ×›×¤×ª×•×¨ PDF\n- ××—×™×§×ª Cloud Function ×©× ×¤×¨×¡ ×‘-Firebase\n\n×”×¡×™×‘×”: PDF Cloud Function ×”×™×” ×›×‘×“ ××“×™ ×¢×œ ×”××¢×¨×›×ª (400MB ×–×™×›×¨×•×Ÿ, 8-12 ×©× ×™×•×ª).\n××¢×‘×¨ ×œ×¤×ª×¨×•×Ÿ Print CSS ×¤×©×•×˜, ××”×™×¨ ×•×œ×œ× ×¢×œ×•×ª.\n\nğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(npm run deploy:*)",
      "Bash(tee:*)",
      "Bash(echo '×‘×•×“×§ ×× ×§×‘×¦×™× ×–×× ×™×™× ××™×•×‘××™× ×‘×§×•×“ ×”×¨××©×™...' grep -r \"check-announcements\\|analyze-three-types\\|test-ticker\\|migrate-isInternal\" --include=*.html --include=*.js --exclude-dir=node_modules --exclude-dir=.dev-scripts master-admin-panel/ js/ *.html)",
      "Bash(__NEW_LINE__ echo \"\")",
      "Bash(echo 'ğŸ” ×‘×“×™×§×ª ×§×‘×¦×™ ×§×•×“ ×¨××©×™×™× - ×”×× ×§×™×™××™×?' echo echo 'â•â•â• js/ (×××©×§ ××©×ª××©×™×) â•â•â•' ls -1 js/*.js)",
      "Bash(echo echo 'â•â•â• js/modules/ â•â•â•' ls -1 js/modules/*.js)",
      "Bash(echo echo 'â•â•â• master-admin-panel/js/ â•â•â•' ls -1 master-admin-panel/js/*.js)",
      "Bash(echo echo 'â•â•â• master-admin-panel/js/modules/ â•â•â•' ls -1 master-admin-panel/js/modules/*.js)",
      "Bash(echo echo 'â•â•â• master-admin-panel/js/ui/ â•â•â•' ls -1 master-admin-panel/js/ui/*.js)",
      "Bash(echo echo 'â•â•â• functions/ (Cloud Functions) â•â•â•' ls -1 functions/*.js)",
      "Bash(echo '×§×‘×¦×™ ×§×•×“ ×¨××©×™×™×:' echo echo js/: ls js/*.js)",
      "Bash(head -5 echo echo js/modules/: ls js/modules/*.js)",
      "Bash(head -5 echo echo master-admin-panel/js/: ls master-admin-panel/js/*.js)",
      "Bash(head -5 echo echo master-admin-panel/js/ui/: ls master-admin-panel/js/ui/*.js)",
      "Bash(head -5 echo echo 'functions/ (×¨××©×™×™×):' ls functions/*.js)",
      "Bash(test:*)",
      "Bash(head -10 find master-admin-panel/js/ -name *.js -type f)",
      "Bash(npx eslint:*)",
      "Bash(node update-cache-busting.js:*)",
      "Bash(node -c:*)",
      "Bash(timeout 15 bash:*)",
      "Bash(npx netlify:*)",
      "Bash(git stash:*)",
      "Bash(git commit -m \"$(cat <<''EOF''\nfix: Eliminate page flash on navigation with pre-flight auth check\n\nProblem:\nWhen navigating between admin pages (e.g., Employees â†’ Clients), users \nwould see a brief flash of the login screen before the target page loaded.\nThis created a jarring, unprofessional user experience.\n\nRoot Cause:\nFirebase Authentication is asynchronous and takes 200-500ms to verify \nthe user''s auth state. During this time, pages would either:\n1. Display the login screen (task-approvals.html, index.html)\n2. Redirect to index.html (clients.html)\nBoth resulted in a visible \"flash\" before showing the correct content.\n\nSolution - Pre-Flight Auth Check:\nImplemented a lightweight authentication check that runs BEFORE the page \nstarts rendering, using sessionStorage for instant validation:\n\n1. clients.html: Added pre-flight script in <head>\n   - Checks sessionStorage for recent auth state (<5 min old)\n   - Redirects to index.html IMMEDIATELY if no valid auth\n   - Allows page to load normally if auth is valid\n   - Result: No loading screen needed, page appears instantly\n\n2. index.html, task-approvals.html: Cross-tab logout sync\n   - Added storage event listener for logout events\n   - Ensures all tabs logout when one tab logs out\n   - Prevents stale authenticated state\n\n3. auth.js enhancements:\n   - showDashboard(): Updates sessionStorage with auth state + timestamp\n   - handleLogout(): Clears sessionStorage and broadcasts logout event\n   - Cross-tab synchronization via localStorage events\n\nTechnical Details:\n- SessionStorage stores: {isAuthenticated, timestamp, email, uid}\n- 5-minute freshness window prevents stale auth state\n- localStorage events for cross-tab communication\n- Zero loading screens or spinners needed\n- Page navigation is instant and seamless\n\nImpact:\nâœ… Eliminates all page flash/flicker during navigation\nâœ… Instant page loads (no loading screens)\nâœ… Cross-tab logout synchronization\nâœ… Clean, professional user experience\nâœ… Simple solution (~100 lines vs 550-line AuthGuard)\n\nFiles Changed:\n- master-admin-panel/clients.html: Pre-flight check + cross-tab sync\n- master-admin-panel/task-approvals.html: Cross-tab sync\n- master-admin-panel/index.html: Cross-tab sync\n- master-admin-panel/js/core/auth.js: SessionStorage management\n\nğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(git stash show:*)",
      "Bash(while IFS='|' read hash author email subject)",
      "Bash(do echo \"===\")",
      "Bash(copy clients.css clients.css.BACKUP)",
      "Bash(netlify api updateSite:*)"
    ],
    "deny": [],
    "ask": []
  }
}
