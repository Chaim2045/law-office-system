# מדריך חקירה: בעיית דוח תמיר אקווה

**תאריך:** 2026-02-04
**בעיה:** דוח לקוח מציג שעות אבל לא מציג סיכום

---

## 📋 תיאור הבעיה

1. ✅ לקוח "תמיר אקווה" היה בחריגה
2. ✅ סגרת את התיק (סטטוס: מושלם)
3. ✅ פתחת תיק חדש
4. ❌ משתמשים אחרים המשיכו להוסיף משימות על התיק הישן
5. ❌ בדוח רואים את השעות אבל **לא** את הסיכום למטה

---

## 🔍 תהליך החקירה

### שלב 1: חקירה כללית (חיפוש תמיר אקווה)

**איפה:** Admin Panel → כל עמוד

**פעולות:**
1. פתח את Admin Panel: https://law-office-system-e4801.web.app/master-admin-panel/
2. לחץ F12 (פתיחת Developer Console)
3. לחץ על Tab "Console"
4. העתק והדבק את הקוד מהקובץ:

```
.dev/investigate-tamir-akiva-report.js
```

5. לחץ Enter

**מה הסקריפט עושה:**
- ✅ מחפש לקוח בשם "תמיר אקווה"
- ✅ מציג את כל השירותים שלו (פעילים וסגורים)
- ✅ מונה כמה רשומות שעתון יש לו
- ✅ מונה כמה משימות יש לו
- ✅ בודק אם יש משימות פתוחות על שירותים סגורים
- ✅ מזהה אי-התאמות בין שמות שירותים
- ✅ מציג המלצות לפתרון

**תוצאה:**
הסקריפט ידפיס דוח מפורט בקונסול. **תעתיק את כל הפלט** ותשלח לי.

---

### שלב 2: בדיקת הדוח עצמו

**איפה:** Admin Panel → Clients → תמיר אקווה → כפתור "דוח"

**פעולות:**
1. פתח את דף Clients
2. מצא את תמיר אקווה בטבלה
3. לחץ על כפתור **"דוח"**
4. המתן שהדוח ייטען
5. לחץ F12 (Console)
6. העתק והדבק את הקוד מהקובץ:

```
.dev/check-report-calculation.js
```

7. לחץ Enter

**מה הסקריפט עושה:**
- ✅ בודק איזה נתונים נטענו לדוח
- ✅ מחשב את סיכום השעות ידנית
- ✅ משווה לסיכום שמוצג בדוח
- ✅ מזהה רשומות ללא serviceName
- ✅ בודק אם יש אלמנט סיכום ב-HTML

**תוצאה:**
הסקריפט ידפיס ניתוח של הדוח. **תעתיק את כל הפלט** ותשלח לי.

---

## 🐛 תרחישי בעיה אפשריים

### תרחיש 1: רשומות שעתון ללא serviceName

**סימפטום:**
```
⚠️ 15 רשומות ללא serviceName!
```

**הסבר:**
- רשומות שעתון שלא משוייכות לשירות ספציפי
- הקוד של הדוח לא יודע לאיזה שירות לשייך אותן
- לכן הן לא מופיעות בסיכום

**פתרון:**
- עדכן את רשומות השעתון עם serviceName נכון
- או שנתקן את קוד הדוח להציג גם רשומות ללא שירות

---

### תרחיש 2: אי-התאמה בשמות שירותים

**סימפטום:**
```
⚠️ "תיק ישן - 2024" - קיים בשעתון אבל לא בלקוח!
```

**הסבר:**
- עובדים תיעדו שעות על שירות בשם "תיק ישן - 2024"
- אבל בלקוח אין שירות בשם הזה (כי שינית או מחקת)
- הדוח לא יודע להציג שעות על שירות שלא קיים

**פתרון אפשרי 1:**
- עדכן את serviceName ברשומות השעתון לשם השירות החדש

**פתרון אפשרי 2:**
- הוסף את השירות הישן בחזרה ללקוח (עם סטטוס "completed")

---

### תרחיש 3: משימות פתוחות על שירותים סגורים

**סימפטום:**
```
🔴 משימה: ייעוץ משפטי לתמיר
   שירות: תיק ישן - 2024 (סטטוס: הושלם)
   עובד: marva@ghlawoffice.co.il
```

**הסבר:**
- עובדים המשיכו להוסיף משימות על שירות שסגרת
- המשימות עדיין פעילות ולכן מופיעות בדוח
- אבל השירות סגור, מה שעלול ליצור בלבול

**פתרון:**
- סגור את המשימות הפתוחות (סטטוס: "הושלם")
- או העבר אותן לשירות חדש (שנה serviceName)

---

### תרחיש 4: שם לקוח לא עקבי

**סימפטום:**
```
⚠️ נמצאו 2 שמות שונים ברשומות שעתון:
   - "תמיר אקווה" (אורך: 10)
   - "תמיר אקווה " (אורך: 11) ← רווח בסוף!
```

**הסבר:**
- שם הלקוח נכתב קצת אחרת ברשומות שונות
- ההבדל יכול להיות רווח, אות גדולה/קטנה, או טעות כתיב
- הקוד לא מזהה שזה אותו לקוח

**פתרון:**
- תקן את שם הלקוח בכל הרשומות להיות זהה בדיוק
- או שנתקן את הקוד לעשות חיפוש לא case-sensitive

---

## 📤 מה לשלוח לי

אחרי שתריץ את **שני הסקריפטים**, תעתיק ותשלח לי:

1. **כל הפלט מהקונסול** מסקריפט 1 (investigate-tamir-akiva-report.js)
2. **כל הפלט מהקונסול** מסקריפט 2 (check-report-calculation.js)
3. **צילום מסך של הדוח** (עם הבעיה)
4. **Client ID של תמיר אקווה** (אם הסקריפט מצא אותו)

**איך מעתיקים מהקונסול:**
1. סמן את כל הטקסט (Ctrl+A)
2. לחץ עליו ימין → Copy
3. הדבק בהודעה אליי

---

## 🎯 מה אעשה עם המידע

אחרי שתשלח לי את הנתונים, אני אוכל:

1. ✅ לזהות בדיוק מה הבעיה
2. ✅ לספר לך איזה שדות צריך לתקן
3. ✅ ליצור סקריפט תיקון אוטומטי (אם נדרש)
4. ✅ לתקן את קוד הדוח (אם זו באג בקוד)
5. ✅ להסביר לך איך למנוע את זה בעתיד

---

## 🚀 אם אתה רוצה Client ID ספציפי

אם אתה יודע את ה-Client ID של תמיר אקווה, תוכל לדלג על החיפוש:

```javascript
// בקונסול, רוץ:
investigateTamirAkivaById("CLIENT_ID_כאן")
```

**איך מוצאים את ה-Client ID:**
1. פתח Admin Panel → Clients
2. מצא את תמיר אקווה
3. לחץ ימין → Inspect Element
4. חפש `data-client-id="..."`
5. זה ה-ID

---

## 📝 הערות חשובות

1. ⚠️ **אל תריץ סקריפטים בסביבת PRODUCTION** ללא אישור
   - הסקריפטים האלה **רק קוראים** נתונים
   - הם **לא משנים** שום דבר ב-Firestore
   - בטוח להריץ

2. 💡 **תמיד רוץ בדף הנכון:**
   - סקריפט 1: בכל עמוד Admin Panel
   - סקריפט 2: רק כשדוח פתוח

3. 🔒 **הנתונים רגישים:**
   - אם אתה שולח לי פלט, תוודא שאין מידע רגיש
   - אני צריך רק את המבנה, לא את כל התוכן

---

**בהצלחה! 🚀**

אם משהו לא עובד, תגיד לי ונתקן את הסקריפט.
