# 
# Master Admin Panel - Netlify Configuration
# 
#  PRODUCTION (LIVE - 砖转砖 转!)
#    Branch: production-stable
#    URL: https://admin-gh-law-office-system.netlify.app
#
#  DEVELOPMENT/TESTING (住 )
#    Branch: main
#    URL: https://main--admin-gh-law-office-system.netlify.app
#
# Main App URL: https://gh-law-office-system.netlify.app
# Firebase Backend: law-office-system-e4801.web.app
# 

[build]
  # Base directory is set in Netlify Dashboard: master-admin-panel
  # Publish from current directory (we're already in master-admin-panel)
  publish = "."
  command = "echo 'Admin panel build complete'"

# Main Branch - 住转 驻转/住
[context.main]
  command = "echo 'Admin panel preview build complete'"

[context.main.environment]
  NODE_VERSION = "18"
  ENVIRONMENT = "development"

# Production-Stable Branch - 爪专 转!
[context.production-stable]
  command = "echo 'Admin panel production build complete'"

[context.production-stable.environment]
  NODE_VERSION = "18"
  ENVIRONMENT = "production"

# Production environment variables (fallback)
[context.production.environment]
  NODE_VERSION = "18"

# 
# STATIC ASSETS - Serve directly, do NOT redirect to index.html
# 
# IMPORTANT: These MUST come BEFORE the SPA catch-all redirect
# Otherwise JS/CSS files will get index.html instead of actual file content
[[redirects]]
  from = "/js/*"
  to = "/js/:splat"
  status = 200
  force = false

[[redirects]]
  from = "/css/*"
  to = "/css/:splat"
  status = 200
  force = false

[[redirects]]
  from = "/components/*"
  to = "/components/:splat"
  status = 200
  force = false

[[redirects]]
  from = "/assets/*"
  to = "/assets/:splat"
  status = 200
  force = false

# SPA routing - all routes to index.html (AFTER static assets)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Security headers - Enhanced for Admin Panel
[[headers]]
  for = "/*"
  [headers.values]
    # Security headers
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "geolocation=(), microphone=(), camera=()"

    # Admin-specific security
    X-XSS-Protection = "1; mode=block"
    Strict-Transport-Security = "max-age=31536000; includeSubDomains; preload"

    # Content Security Policy (strict for admin)
    Content-Security-Policy = """
      default-src 'self';
      script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net;
      style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com;
      font-src 'self' https://cdnjs.cloudflare.com;
      img-src 'self' data: https:;
      connect-src 'self' https://*.firebaseio.com https://*.googleapis.com https://firestore.googleapis.com https://*.cloudfunctions.net wss://*.firebaseio.com;
      frame-ancestors 'none';
    """

# Cache control for static assets - NO CACHE for JS/CSS to ensure updates
[[headers]]
  for = "/css/*"
  [headers.values]
    Cache-Control = "public, no-cache, must-revalidate"

[[headers]]
  for = "/js/*"
  [headers.values]
    Cache-Control = "public, no-cache, must-revalidate"

# Prevent caching of HTML
[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "no-cache, no-store, must-revalidate"
