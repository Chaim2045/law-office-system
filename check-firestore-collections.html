<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>בדיקת Collections ב-Firestore</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
      direction: rtl;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 { color: #333; margin-bottom: 20px; }
    .collection {
      margin: 15px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 5px;
      border-left: 4px solid #667eea;
    }
    .collection-name {
      font-weight: bold;
      font-size: 18px;
      color: #667eea;
      margin-bottom: 10px;
    }
    .doc-count {
      color: #666;
      font-size: 14px;
    }
    .doc-list {
      margin-top: 10px;
      padding-left: 20px;
    }
    .doc-item {
      padding: 5px;
      margin: 3px 0;
      background: white;
      border-radius: 3px;
      font-size: 13px;
    }
    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #5568d3;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
    }
    .status-info { background: #d1ecf1; color: #0c5460; }
    .status-success { background: #d4edda; color: #155724; }
    .status-error { background: #f8d7da; color: #721c24; }
    pre {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🔍 בדיקת Collections ב-Firestore</h1>

    <div id="status"></div>

    <button onclick="checkCollections()">בדוק Collections</button>

    <div id="results"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDCbV-I8J5jtNEbM3d6vH7X8CfXZ9Y0j4Y",
      authDomain: "law-office-system.firebaseapp.com",
      projectId: "law-office-system",
      storageBucket: "law-office-system.appspot.com",
      messagingSenderId: "123456789",
      appId: "1:123456789:web:abcdef"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function showStatus(msg, type = 'info') {
      const el = document.getElementById('status');
      el.innerHTML = msg;
      el.className = 'status status-' + type;
    }

    async function checkCollections() {
      showStatus('🔍 בודק collections...', 'info');

      const results = document.getElementById('results');
      results.innerHTML = '';

      const collectionsToCheck = [
        'employees',
        'users',
        'clients',
        'budget_tasks',
        'timesheet_entries',
        'activities',
        'settings'
      ];

      let foundCollections = 0;

      for (const collectionName of collectionsToCheck) {
        try {
          console.log(`Checking collection: ${collectionName}`);
          const snapshot = await db.collection(collectionName).limit(10).get();

          const div = document.createElement('div');
          div.className = 'collection';

          if (snapshot.empty) {
            div.innerHTML = `
              <div class="collection-name">📁 ${collectionName}</div>
              <div class="doc-count">⚠️ Collection קיים אבל ריק (0 documents)</div>
            `;
          } else {
            foundCollections++;
            const docs = [];
            snapshot.forEach(doc => {
              docs.push({
                id: doc.id,
                data: doc.data()
              });
            });

            div.innerHTML = `
              <div class="collection-name">✅ ${collectionName}</div>
              <div class="doc-count">📊 ${snapshot.size} documents נמצאו</div>
              <div class="doc-list">
                ${docs.map(doc => `
                  <div class="doc-item">
                    🔹 <strong>${doc.id}</strong>
                    ${doc.data.name ? ` - ${doc.data.name}` : ''}
                    ${doc.data.email ? ` - ${doc.data.email}` : ''}
                    ${doc.data.displayName ? ` - ${doc.data.displayName}` : ''}
                  </div>
                `).join('')}
              </div>
              <details style="margin-top: 10px;">
                <summary style="cursor: pointer; color: #667eea;">הצג JSON מלא</summary>
                <pre>${JSON.stringify(docs, null, 2)}</pre>
              </details>
            `;
          }

          results.appendChild(div);

        } catch (error) {
          console.error(`Error checking ${collectionName}:`, error);
          const div = document.createElement('div');
          div.className = 'collection';
          div.innerHTML = `
            <div class="collection-name">❌ ${collectionName}</div>
            <div class="doc-count">שגיאה: ${error.message}</div>
          `;
          results.appendChild(div);
        }
      }

      if (foundCollections === 0) {
        showStatus('⚠️ לא נמצאו collections עם נתונים! כל הנתונים כנראה רק ב-localStorage', 'error');
      } else {
        showStatus(`✅ נמצאו ${foundCollections} collections עם נתונים`, 'success');
      }
    }

    // בדיקה אוטומטית בטעינה
    window.addEventListener('load', checkCollections);
  </script>
</body>
</html>
