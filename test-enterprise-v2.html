<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>×‘×“×™×§×ª Enterprise v2.0</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      direction: rtl;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 40px;
    }

    h1 {
      color: #2d3748;
      margin-bottom: 10px;
      font-size: 32px;
    }

    .subtitle {
      color: #718096;
      margin-bottom: 30px;
      font-size: 16px;
    }

    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f7fafc;
      border-radius: 12px;
      border: 2px solid #e2e8f0;
    }

    .test-section h2 {
      color: #2d3748;
      margin-bottom: 15px;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .status {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
    }

    .status.pending {
      background: #fef3c7;
      color: #92400e;
    }

    .status.success {
      background: #d1fae5;
      color: #065f46;
    }

    .status.error {
      background: #fee2e2;
      color: #991b1b;
    }

    .result {
      margin-top: 10px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      border-right: 4px solid #e2e8f0;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: #2d3748;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .result.success {
      border-right-color: #10b981;
    }

    .result.error {
      border-right-color: #ef4444;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 15px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .icon {
      width: 20px;
      height: 20px;
      display: inline-block;
    }

    .summary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
    }

    .summary h3 {
      margin-bottom: 10px;
      font-size: 18px;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .summary-item {
      background: rgba(255,255,255,0.2);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }

    .summary-item .number {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .summary-item .label {
      font-size: 14px;
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš€ ×‘×“×™×§×ª Enterprise v2.0</h1>
    <p class="subtitle">××¢×¨×›×ª ×‘×“×™×§×” ××•×˜×•××˜×™×ª ×œ×ª×©×ª×™×ª Absolute Accuracy</p>

    <div class="summary" id="summary" style="display: none;">
      <h3>ğŸ“Š ×ª×•×¦××•×ª ×›×œ×œ×™×•×ª</h3>
      <div class="summary-grid">
        <div class="summary-item">
          <div class="number" id="successCount">0</div>
          <div class="label">×‘×“×™×§×•×ª ×¢×‘×¨×• âœ…</div>
        </div>
        <div class="summary-item">
          <div class="number" id="failCount">0</div>
          <div class="label">×‘×“×™×§×•×ª × ×›×©×œ×• âŒ</div>
        </div>
        <div class="summary-item">
          <div class="number" id="totalCount">0</div>
          <div class="label">×¡×”"×› ×‘×“×™×§×•×ª</div>
        </div>
      </div>
    </div>

    <!-- Test 1: Module Loading -->
    <div class="test-section">
      <h2>
        <span class="icon">ğŸ“¦</span>
        ×‘×“×™×§×” 1: ×˜×¢×™× ×ª ××•×“×•×œ×™×
        <span class="status pending" id="status1">×××ª×™×Ÿ...</span>
      </h2>
      <div class="result" id="result1">×œ× ×”×•×¨×¥ ×¢×“×™×™×Ÿ</div>
    </div>

    <!-- Test 2: Function Availability -->
    <div class="test-section">
      <h2>
        <span class="icon">ğŸ”§</span>
        ×‘×“×™×§×” 2: ×–××™× ×•×ª ×¤×•× ×§×¦×™×•×ª v2
        <span class="status pending" id="status2">×××ª×™×Ÿ...</span>
      </h2>
      <div class="result" id="result2">×œ× ×”×•×¨×¥ ×¢×“×™×™×Ÿ</div>
    </div>

    <!-- Test 3: Firebase Connection -->
    <div class="test-section">
      <h2>
        <span class="icon">ğŸ”¥</span>
        ×‘×“×™×§×” 3: ×—×™×‘×•×¨ Firebase
        <span class="status pending" id="status3">×××ª×™×Ÿ...</span>
      </h2>
      <div class="result" id="result3">×œ× ×”×•×¨×¥ ×¢×“×™×™×Ÿ</div>
    </div>

    <!-- Test 4: Cloud Functions -->
    <div class="test-section">
      <h2>
        <span class="icon">â˜ï¸</span>
        ×‘×“×™×§×” 4: Cloud Functions
        <span class="status pending" id="status4">×××ª×™×Ÿ...</span>
      </h2>
      <div class="result" id="result4">×œ× ×”×•×¨×¥ ×¢×“×™×™×Ÿ</div>
    </div>

    <button onclick="runAllTests()" id="runBtn">×”×¨×¥ ××ª ×›×œ ×”×‘×“×™×§×•×ª</button>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-functions-compat.js"></script>

  <script type="module">
    // Import main.js to load all modules
    import './js/main.js';

    let testResults = {
      success: 0,
      fail: 0,
      total: 0
    };

    function updateStatus(testNum, status, message) {
      const statusEl = document.getElementById(`status${testNum}`);
      const resultEl = document.getElementById(`result${testNum}`);

      statusEl.className = `status ${status}`;
      statusEl.textContent = status === 'success' ? 'âœ… ×”×¦×œ×™×—' : status === 'error' ? 'âŒ × ×›×©×œ' : 'â³ ×¨×¥...';

      resultEl.className = `result ${status}`;
      resultEl.textContent = message;

      if (status === 'success') testResults.success++;
      if (status === 'error') testResults.fail++;
      testResults.total++;

      updateSummary();
    }

    function updateSummary() {
      document.getElementById('summary').style.display = 'block';
      document.getElementById('successCount').textContent = testResults.success;
      document.getElementById('failCount').textContent = testResults.fail;
      document.getElementById('totalCount').textContent = testResults.total;
    }

    async function test1_ModuleLoading() {
      updateStatus(1, 'pending', '×‘×•×“×§ ×˜×¢×™× ×ª ××•×“×•×œ×™×...');

      try {
        const modules = {
          'window.manager': typeof window.manager,
          'window.saveTimesheetToFirebase': typeof window.saveTimesheetToFirebase,
          'window.saveTimesheetToFirebase_v2': typeof window.saveTimesheetToFirebase_v2,
          'window.FirebaseService': typeof window.FirebaseService
        };

        let message = '××•×“×•×œ×™× ×©× ×˜×¢× ×•:\n';
        let allLoaded = true;

        for (const [name, type] of Object.entries(modules)) {
          const loaded = type !== 'undefined';
          message += `${loaded ? 'âœ…' : 'âŒ'} ${name}: ${type}\n`;
          if (!loaded) allLoaded = false;
        }

        if (allLoaded) {
          updateStatus(1, 'success', message);
        } else {
          updateStatus(1, 'error', message + '\nâš ï¸ ×—×œ×§ ××”××•×“×•×œ×™× ×œ× × ×˜×¢× ×•!');
        }
      } catch (error) {
        updateStatus(1, 'error', `×©×’×™××”: ${error.message}`);
      }
    }

    async function test2_FunctionAvailability() {
      updateStatus(2, 'pending', '×‘×•×“×§ ×–××™× ×•×ª ×¤×•× ×§×¦×™×•×ª v2...');

      try {
        const v2Available = typeof window.saveTimesheetToFirebase_v2 === 'function';
        const v1Available = typeof window.saveTimesheetToFirebase === 'function';

        let message = '';
        message += `âœ… v1 (saveTimesheetToFirebase): ${v1Available ? '×§×™×™×' : '×—×¡×¨'}\n`;
        message += `âœ… v2 (saveTimesheetToFirebase_v2): ${v2Available ? '×§×™×™×' : '×—×¡×¨'}\n\n`;

        if (v2Available) {
          // ×‘×“×™×§×ª signature
          message += 'Signature ×©×œ v2:\n';
          message += window.saveTimesheetToFirebase_v2.toString().split('\n').slice(0, 5).join('\n');

          updateStatus(2, 'success', message);
        } else {
          updateStatus(2, 'error', message + '\nâŒ saveTimesheetToFirebase_v2 ×œ× × ××¦×!');
        }
      } catch (error) {
        updateStatus(2, 'error', `×©×’×™××”: ${error.message}`);
      }
    }

    async function test3_FirebaseConnection() {
      updateStatus(3, 'pending', '×‘×•×“×§ ×—×™×‘×•×¨ Firebase...');

      try {
        const app = firebase.app();
        const config = app.options;

        let message = 'Firebase ××—×•×‘×¨!\n\n';
        message += `Project ID: ${config.projectId}\n`;
        message += `API Key: ${config.apiKey?.substring(0, 20)}...\n`;
        message += `Auth Domain: ${config.authDomain}\n`;

        // ×‘×“×™×§×ª Firestore
        const db = firebase.firestore();
        message += `\nâœ… Firestore: ××—×•×‘×¨`;

        // ×‘×“×™×§×ª Functions
        const functions = firebase.functions();
        message += `\nâœ… Functions: ××—×•×‘×¨ (${functions._region})`;

        updateStatus(3, 'success', message);
      } catch (error) {
        updateStatus(3, 'error', `×©×’×™××” ×‘×—×™×‘×•×¨ Firebase:\n${error.message}`);
      }
    }

    async function test4_CloudFunctions() {
      updateStatus(4, 'pending', '×‘×•×“×§ Cloud Functions...');

      try {
        const functions = firebase.functions();

        let message = '×‘×•×“×§ ×–××™× ×•×ª Functions:\n\n';

        // ×¨×©×™××ª functions ×œ×‘×“×™×§×”
        const functionsToCheck = [
          'createTimesheetEntry',
          'createTimesheetEntry_v2',
          'migrateClientsAddVersionControl'
        ];

        let allAvailable = true;

        for (const funcName of functionsToCheck) {
          try {
            const func = functions.httpsCallable(funcName);
            message += `âœ… ${funcName}: ×–××™×Ÿ\n`;
          } catch (error) {
            message += `âŒ ${funcName}: ×œ× ×–××™×Ÿ\n`;
            allAvailable = false;
          }
        }

        if (allAvailable) {
          message += '\nğŸ‰ ×›×œ ×”-Functions ×–××™× ×™× ×•××•×›× ×™× ×œ×©×™××•×©!';
          updateStatus(4, 'success', message);
        } else {
          message += '\nâš ï¸ ×—×œ×§ ××”-Functions ×œ× ×–××™× ×™×';
          updateStatus(4, 'error', message);
        }
      } catch (error) {
        updateStatus(4, 'error', `×©×’×™××” ×‘×‘×“×™×§×ª Functions:\n${error.message}`);
      }
    }

    window.runAllTests = async function() {
      const btn = document.getElementById('runBtn');
      btn.disabled = true;
      btn.textContent = '×¨×¥...';

      testResults = { success: 0, fail: 0, total: 0 };

      await test1_ModuleLoading();
      await new Promise(resolve => setTimeout(resolve, 500));

      await test2_FunctionAvailability();
      await new Promise(resolve => setTimeout(resolve, 500));

      await test3_FirebaseConnection();
      await new Promise(resolve => setTimeout(resolve, 500));

      await test4_CloudFunctions();

      btn.disabled = false;
      btn.textContent = '×”×¨×¥ ×©×•×‘';

      // ×”×¦×’ ×¡×™×›×•× ×¡×•×¤×™
      const finalScore = Math.round((testResults.success / testResults.total) * 100);
      if (finalScore === 100) {
        alert('ğŸ‰ ×›×œ ×”×‘×“×™×§×•×ª ×¢×‘×¨×• ×‘×”×¦×œ×—×”! ×”××¢×¨×›×ª ××•×›× ×” ×œ×©×™××•×©.');
      } else {
        alert(`âš ï¸ ${testResults.fail} ××ª×•×š ${testResults.total} ×‘×“×™×§×•×ª × ×›×©×œ×•. ×× × ×‘×“×•×§ ××ª ×”×©×’×™××•×ª.`);
      }
    };
  </script>
</body>
</html>
