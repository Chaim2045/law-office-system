<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>×‘×“×™×§×ª NotificationBell</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
      direction: rtl;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 800px;
      margin: 0 auto;
    }
    .status {
      padding: 15px;
      margin: 10px 0;
      border-radius: 6px;
      font-weight: 600;
    }
    .success { background: #d1fae5; border: 1px solid #10b981; color: #065f46; }
    .error { background: #fee2e2; border: 1px solid #dc2626; color: #991b1b; }
    .info { background: #dbeafe; border: 1px solid #2563eb; color: #1e40af; }
    pre {
      background: #f0f0f0;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      direction: ltr;
      text-align: left;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }
    button:hover {
      background: #1d4ed8;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” ×‘×“×™×§×ª NotificationBell System</h1>
    <div id="status"></div>
    <div id="details"></div>

    <h2>ğŸ› ï¸ ×‘×“×™×§×•×ª</h2>
    <button onclick="testNotificationBell()">1ï¸âƒ£ ×‘×“×•×§ ××ª×—×•×œ NotificationBell</button>
    <button onclick="testFirebaseAuth()">2ï¸âƒ£ ×‘×“×•×§ Firebase Auth</button>
    <button onclick="testFirestore()">3ï¸âƒ£ ×‘×“×•×§ Firestore</button>

    <div id="testResults"></div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

  <!-- Firebase Config -->
  <script src="js/config/firebase-config.js"></script>

  <!-- NotificationBell - the file we're testing! -->
  <script src="js/modules/notification-bell.js?v=20251209-no-modules"></script>

  <script>
    // Wait for page to load
    window.addEventListener('load', () => {
      checkInitialStatus();
    });

    function checkInitialStatus() {
      const statusDiv = document.getElementById('status');
      const detailsDiv = document.getElementById('details');

      let html = '<h2>ğŸ“Š ×¡×˜×˜×•×¡ ×¨××©×•× ×™</h2>';

      // Check 1: NotificationBell loaded?
      if (typeof window.NotificationBellSystem !== 'undefined') {
        html += '<div class="status success">âœ… NotificationBellSystem class ×§×™×™×</div>';
      } else {
        html += '<div class="status error">âŒ NotificationBellSystem class ×œ× ×§×™×™×</div>';
      }

      // Check 2: Instance created?
      if (typeof window.notificationBell !== 'undefined') {
        html += '<div class="status success">âœ… window.notificationBell ××•×ª×—×œ ×‘×”×¦×œ×—×”</div>';
      } else {
        html += '<div class="status error">âŒ window.notificationBell ×œ× ×§×™×™×</div>';
      }

      // Check 3: Firebase loaded?
      if (typeof firebase !== 'undefined') {
        html += '<div class="status success">âœ… Firebase × ×˜×¢×Ÿ</div>';
      } else {
        html += '<div class="status error">âŒ Firebase ×œ× × ×˜×¢×Ÿ</div>';
      }

      // Check 4: Console errors?
      html += '<div class="status info">â„¹ï¸ ×‘×“×•×§ ××ª ×”-Console ×œ×©×’×™××•×ª</div>';

      statusDiv.innerHTML = html;

      // Show details
      if (window.notificationBell) {
        detailsDiv.innerHTML = `
          <h3>ğŸ” ×¤×¨×˜×™ NotificationBell</h3>
          <pre>${JSON.stringify({
            notifications: window.notificationBell.notifications?.length || 0,
            hasListenToMessages: typeof window.notificationBell.listenToMessages === 'function',
            hasUpdateBell: typeof window.notificationBell.updateBell === 'function'
          }, null, 2)}</pre>
        `;
      }
    }

    function testNotificationBell() {
      const resultsDiv = document.getElementById('testResults');

      if (!window.notificationBell) {
        resultsDiv.innerHTML = '<div class="status error">âŒ window.notificationBell ×œ× ×§×™×™×!</div>';
        return;
      }

      const tests = {
        'notifications array': Array.isArray(window.notificationBell.notifications),
        'listenToMessages method': typeof window.notificationBell.listenToMessages === 'function',
        'updateBell method': typeof window.notificationBell.updateBell === 'function',
        'renderNotifications method': typeof window.notificationBell.renderNotifications === 'function',
        'updateMessagesIconBadge method': typeof window.notificationBell.updateMessagesIconBadge === 'function'
      };

      let html = '<h3>ğŸ“‹ ×ª×•×¦××•×ª ×‘×“×™×§×ª NotificationBell</h3>';

      for (const [test, passed] of Object.entries(tests)) {
        const className = passed ? 'success' : 'error';
        const icon = passed ? 'âœ…' : 'âŒ';
        html += `<div class="status ${className}">${icon} ${test}</div>`;
      }

      resultsDiv.innerHTML = html;
    }

    function testFirebaseAuth() {
      const resultsDiv = document.getElementById('testResults');

      if (!firebase || !firebase.auth) {
        resultsDiv.innerHTML = '<div class="status error">âŒ Firebase Auth ×œ× ×–××™×Ÿ</div>';
        return;
      }

      const user = firebase.auth().currentUser;

      let html = '<h3>ğŸ” Firebase Authentication</h3>';

      if (user) {
        html += `
          <div class="status success">âœ… ××©×ª××© ××—×•×‘×¨</div>
          <pre>${JSON.stringify({
            email: user.email,
            uid: user.uid,
            displayName: user.displayName
          }, null, 2)}</pre>
        `;
      } else {
        html += '<div class="status info">â„¹ï¸ ××™×Ÿ ××©×ª××© ××—×•×‘×¨ (×¦×¨×™×š ×œ×”×™×›× ×¡ ×“×¨×š index.html)</div>';
      }

      resultsDiv.innerHTML = html;
    }

    async function testFirestore() {
      const resultsDiv = document.getElementById('testResults');

      if (!firebase || !firebase.firestore) {
        resultsDiv.innerHTML = '<div class="status error">âŒ Firebase Firestore ×œ× ×–××™×Ÿ</div>';
        return;
      }

      const db = firebase.firestore();

      try {
        const snapshot = await db.collection('user_messages')
          .orderBy('createdAt', 'desc')
          .limit(5)
          .get();

        let html = '<h3>ğŸ“¨ 5 ×”×”×•×“×¢×•×ª ×”××—×¨×•× ×•×ª ×-Firestore</h3>';
        html += `<div class="status success">âœ… × ××¦××• ${snapshot.size} ×”×•×“×¢×•×ª</div>`;

        snapshot.forEach((doc, index) => {
          const data = doc.data();
          html += `
            <div class="status info">
              ×”×•×“×¢×” #${index + 1}: ${data.from} â†’ ${data.to}<br>
              ×¡×˜×˜×•×¡: ${data.status} | ×§×˜×’×•×¨×™×”: ${data.category || 'N/A'}<br>
              ${data.subject ? `× ×•×©×: ${data.subject}<br>` : ''}
              ${data.message.substring(0, 100)}...
            </div>
          `;
        });

        resultsDiv.innerHTML = html;
      } catch (error) {
        resultsDiv.innerHTML = `<div class="status error">âŒ ×©×’×™××”: ${error.message}</div>`;
      }
    }
  </script>
</body>
</html>
