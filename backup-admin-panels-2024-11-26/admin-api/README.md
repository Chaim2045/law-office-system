# ğŸ›ï¸ Admin API - ××¢×¨×›×ª × ×™×”×•×œ ××ª×§×“××ª

> **×’×¨×¡×”:** 1.0.0
> **×ª××¨×™×š ×™×¦×™×¨×”:** 23 ××•×§×˜×•×‘×¨ 2025
> **×¤×™×ª×•×—:** ××¢×¨×›×ª × ×™×”×•×œ ××©×¨×“ ×¢×•"×“ ×’×™× ×”×¨×©×§×•×‘×™×¥

---

## ğŸ“‹ ×ª×•×›×Ÿ ×¢× ×™×™× ×™×

1. [××‘×•×](#××‘×•×)
2. [××¨×›×™×˜×§×˜×•×¨×”](#××¨×›×™×˜×§×˜×•×¨×”)
3. [××‘× ×” ×”×ª×™×§×™×•×ª](#××‘× ×”-×”×ª×™×§×™×•×ª)
4. [API Reference](#api-reference)
5. [×”×ª×§× ×” ×•×¤×¨×™×¡×”](#×”×ª×§× ×”-×•×¤×¨×™×¡×”)
6. [××‘×˜×—×”](#××‘×˜×—×”)
7. [×“×•×’×××•×ª ×©×™××•×©](#×“×•×’×××•×ª-×©×™××•×©)

---

## ğŸ¯ ××‘×•×

**Admin API** ×”×™× ××¢×¨×›×ª × ×™×”×•×œ ××ª×§×“××ª ×”×××¤×©×¨×ª ×œ×× ×”×œ ×”××¢×¨×›×ª ×œ×‘×¦×¢ ×¤×¢×•×œ×•×ª × ×™×”×•×œ ××œ××•×ª ×‘××¢×¨×›×ª ××©×¨×“ ×¢×•×¨×›×™ ×”×“×™×Ÿ.

### ×œ××” ×‘× ×™× ×• ××ª ×–×”?

×‘××¢×¨×›×•×ª ××•×“×¨× ×™×•×ª, **×œ×¢×•×œ× ×œ× × ×•×ª× ×™× ×œ××©×ª××© ×’×™×©×” ×™×©×™×¨×” ×œ××¡×“ ×”× ×ª×•× ×™×** - ×’× ×œ× ×œ×× ×”×œ×™×!

×‘××§×•× ×–×”, ×‘×•× ×™× **Admin API** ×©××¡×¤×§:
- âœ… **××‘×˜×—×” ××§×¡×™××œ×™×ª** - ×›×œ ×¤×¢×•×œ×” ×¢×•×‘×¨×ª ×‘×“×™×§×•×ª
- âœ… **Audit Trail** - ×›×œ ×¤×¢×•×œ×” ××ª×•×¢×“×ª ××•×˜×•××˜×™×ª
- âœ… **×’××™×©×•×ª** - ×§×œ ×œ×”×•×¡×™×£ ×¤×™×¦'×¨×™× ×—×“×©×™×
- âœ… **×©×œ×™×˜×” ××œ××”** - ×”××¢×¨×›×ª ××—×œ×™×˜×” ××” ××•×ª×¨ ×•××” ×œ×

---

## ğŸ—ï¸ ××¨×›×™×˜×§×˜×•×¨×”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Admin Dashboard (UI)                      â”‚
â”‚                  admin-dashboard-v3.html                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ HTTPS Calls (Authenticated)
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Firebase Cloud Functions (Admin API)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚    users.js  â”‚  â”‚   tasks.js   â”‚  â”‚notifications â”‚     â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚     .js      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚  Security Checks â†’ Audit Logging â†’ Admin SDK Operations    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Admin SDK (Full Access)
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Firebase Services                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Firestore  â”‚  â”‚    Auth      â”‚  â”‚   Storage    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ×”×”×‘×“×œ ××”×××©×§ ×”×¨×’×™×œ:

| ×”×™×‘×˜ | ×××©×§ ×¨×’×™×œ (index.html) | Admin Dashboard |
|------|------------------------|-----------------|
| ×’×™×©×” ×œ××¡×“ × ×ª×•× ×™× | ×™×©×™×¨×” (Firestore Rules) | ×“×¨×š Admin API ×‘×œ×‘×“ |
| ×”×¨×©××•×ª | ××•×’×‘×œ×•×ª (×¨×§ × ×ª×•× ×™× ×©×œ ×”××©×ª××©) | ××œ××•×ª (×“×¨×š Admin SDK) |
| ×¤×¢×•×œ×•×ª | ×§×¨×™××”/×›×ª×™×‘×” ×‘×¡×™×¡×™×•×ª | ×›×œ ×¤×¢×•×œ×” (××—×™×§×”, ×—×¡×™××”, ×•×›×•') |
| Audit Log | ×œ× | ×›×Ÿ - ×›×œ ×¤×¢×•×œ×” ××ª×•×¢×“×ª |

---

## ğŸ“ ××‘× ×” ×”×ª×™×§×™×•×ª

```
admin-api/
â”œâ”€â”€ README.md                    â† ××ª×” ×›××Ÿ! ×ª×™×¢×•×“ ×¨××©×™
â”‚
â”œâ”€â”€ functions/                   â† Cloud Functions (Backend)
â”‚   â”œâ”€â”€ users.js                 â†’ × ×™×”×•×œ ××©×ª××©×™×
â”‚   â”œâ”€â”€ tasks.js                 â†’ × ×™×”×•×œ ××©×™××•×ª
â”‚   â”œâ”€â”€ notifications.js         â†’ ××¢×¨×›×ª ×”×ª×¨××•×ª
â”‚   â”œâ”€â”€ clients.js               â†’ × ×™×”×•×œ ×œ×§×•×—×•×ª
â”‚   â”œâ”€â”€ audit.js                 â†’ ×™×•××Ÿ ×‘×™×§×•×¨×ª
â”‚   â”œâ”€â”€ utils.js                 â†’ ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ××©×•×ª×¤×•×ª
â”‚   â””â”€â”€ index.js                 â†’ Entry point (exports all)
â”‚
â”œâ”€â”€ dashboard/                   â† Frontend (UI)
â”‚   â”œâ”€â”€ admin-api-client.js      â†’ JavaScript client ×œ×§×¨×™××•×ª API
â”‚   â””â”€â”€ admin-dashboard-v3.html  â†’ ×××©×§ ×”×“×©×‘×•×¨×“
â”‚
â””â”€â”€ docs/                        â† ×ª×™×¢×•×“ ××¤×•×¨×˜
    â”œâ”€â”€ ARCHITECTURE.md          â†’ ××¨×›×™×˜×§×˜×•×¨×” ××¤×•×¨×˜×ª
    â”œâ”€â”€ API_REFERENCE.md         â†’ ×ª×™×¢×•×“ ×›×œ ×”-endpoints
    â”œâ”€â”€ DEPLOYMENT.md            â†’ ×”×•×¨××•×ª ×¤×¨×™×¡×”
    â””â”€â”€ EXAMPLES.md              â†’ ×“×•×’×××•×ª ×©×™××•×©
```

---

## ğŸ”Œ API Reference

### ğŸ‘¥ Users Management

| Function | ×ª×™××•×¨ | ×¤×¨××˜×¨×™× |
|----------|-------|---------|
| `adminCreateUser` | ×™×¦×™×¨×ª ××©×ª××© ×—×“×© | `{ email, password, name, role }` |
| `adminBlockUser` | ×—×¡×™××ª ××©×ª××© | `{ userId }` |
| `adminUnblockUser` | ×‘×™×˜×•×œ ×—×¡×™××ª ××©×ª××© | `{ userId }` |
| `adminDeleteUser` | ××—×™×§×ª ××©×ª××© | `{ userId }` |
| `adminUpdateUserRole` | ×©×™× ×•×™ ×ª×¤×§×™×“ ××©×ª××© | `{ userId, role }` |
| `adminResetPassword` | ×©×œ×™×—×ª ××™×™×œ ×œ××™×¤×•×¡ ×¡×™×¡××” | `{ email }` |

### ğŸ“ Tasks Management

| Function | ×ª×™××•×¨ | ×¤×¨××˜×¨×™× |
|----------|-------|---------|
| `adminTransferTask` | ×”×¢×‘×¨×ª ××©×™××” ×‘×™×Ÿ ×¢×•×‘×“×™× | `{ taskId, fromUserId, toUserId }` |
| `adminBulkTransferTasks` | ×”×¢×‘×¨×ª ×›×œ ×”××©×™××•×ª ×©×œ ×¢×•×‘×“ | `{ fromUserId, toUserId }` |
| `adminDeleteTask` | ××—×™×§×ª ××©×™××” | `{ taskId }` |
| `adminCompleteTask` | ×¡×™××•×Ÿ ××©×™××” ×›×”×•×©×œ××” | `{ taskId }` |

### ğŸ”” Notifications

| Function | ×ª×™××•×¨ | ×¤×¨××˜×¨×™× |
|----------|-------|---------|
| `adminSendNotification` | ×©×œ×™×—×ª ×”×ª×¨××” ×œ××©×ª××© | `{ userId, title, message, type }` |
| `adminBroadcastNotification` | ×©×œ×™×—×ª ×”×ª×¨××” ×œ×›×•×œ× | `{ title, message, type }` |

### ğŸ‘” Clients Management

| Function | ×ª×™××•×¨ | ×¤×¨××˜×¨×™× |
|----------|-------|---------|
| `adminBlockClient` | ×—×¡×™××ª ×œ×§×•×— | `{ clientId }` |
| `adminUnblockClient` | ×‘×™×˜×•×œ ×—×¡×™××ª ×œ×§×•×— | `{ clientId }` |
| `adminTransferClient` | ×”×¢×‘×¨×ª ×œ×§×•×— ×œ×¢×•"×“ ××—×¨ | `{ clientId, toLawyerId }` |

### ğŸ“œ Audit Log

| Function | ×ª×™××•×¨ | ×¤×¨××˜×¨×™× |
|----------|-------|---------|
| `adminGetAuditLog` | ×§×‘×œ×ª ×™×•××Ÿ ×‘×™×§×•×¨×ª | `{ startDate, endDate, limit }` |

---

## ğŸš€ ×”×ª×§× ×” ×•×¤×¨×™×¡×”

### ×©×œ×‘ 1: ×”×•×¡×¤×ª Functions ×œ-Firebase

```bash
# 1. ×”×¢×ª×§ ××ª ×”×§×‘×¦×™× ×-admin-api/functions/ ×œ-functions/admin/
cp admin-api/functions/* functions/admin/

# 2. ×¢×“×›×Ÿ ××ª functions/index.js
# ×”×•×¡×£: exports.admin = require('./admin');

# 3. ×¤×¨×•×¡ ×œ-Firebase
firebase deploy --only functions
```

### ×©×œ×‘ 2: ×¢×“×›×•×Ÿ ×”×“×©×‘×•×¨×“

```bash
# 1. ×”×¢×ª×§ ××ª admin-api-client.js ×œ××§×•× × ×’×™×©
cp admin-api/dashboard/admin-api-client.js admin/

# 2. ×˜×¢×Ÿ ××ª ×”×“×©×‘×•×¨×“ ×”×—×“×©
# ×¤×ª×—: admin/admin-dashboard-v3.html
```

---

## ğŸ” ××‘×˜×—×”

### ×©×›×‘×•×ª ××‘×˜×—×”:

1. **Authentication** - ×›× ×™×¡×” ×¢× Firebase Auth
2. **Authorization** - ×‘×“×™×§×” ×©×”××©×ª××© ×”×•× admin
3. **Audit Logging** - ×ª×™×¢×•×“ ×›×œ ×¤×¢×•×œ×”
4. **Input Validation** - ×‘×“×™×§×ª ×ª×§×™× ×•×ª ×”× ×ª×•× ×™×

### ×“×•×’××” - ×›×œ Function ×‘× ×•×™×” ×›×š:

```javascript
exports.adminXXX = functions.https.onCall(async (data, context) => {
  // âœ… ×©×œ×‘ 1: ×‘×“×™×§×ª ×”×ª×—×‘×¨×•×ª
  if (!context.auth) {
    throw new functions.https.HttpsError('unauthenticated', '×™×© ×œ×”×ª×—×‘×¨');
  }

  // âœ… ×©×œ×‘ 2: ×‘×“×™×§×ª ×”×¨×©××•×ª admin
  if (context.auth.token.email !== 'haim@ghlawoffice.co.il') {
    throw new functions.https.HttpsError('permission-denied', '××™×Ÿ ×”×¨×©××”');
  }

  // âœ… ×©×œ×‘ 3: ×ª×™×¢×•×“ ×”×¤×¢×•×œ×” (Audit)
  await logAudit({
    action: 'ADMIN_XXX',
    performedBy: context.auth.token.email,
    data: data,
    timestamp: admin.firestore.FieldValue.serverTimestamp()
  });

  // âœ… ×©×œ×‘ 4: ×‘×™×¦×•×¢ ×”×¤×¢×•×œ×”
  const result = await doAction(data);

  // âœ… ×©×œ×‘ 5: ×”×—×–×¨×ª ×ª×•×¦××”
  return { success: true, result };
});
```

---

## ğŸ’¡ ×“×•×’×××•×ª ×©×™××•×©

### ×“×•×’××” 1: ×™×¦×™×¨×ª ××©×ª××© ×—×“×©

```javascript
// ×‘×“×©×‘×•×¨×“ (Frontend)
const result = await adminAPI.createUser({
  email: 'employee@example.com',
  password: 'SecurePass123!',
  name: '×©× ×”×¢×•×‘×“',
  role: 'employee'
});

console.log('User created:', result.userId);
```

### ×“×•×’××” 2: ×—×¡×™××ª ××©×ª××©

```javascript
// ×‘×“×©×‘×•×¨×“ (Frontend)
const result = await adminAPI.blockUser({
  userId: '×—×™×™×'
});

console.log('User blocked successfully');
```

### ×“×•×’××” 3: ×”×¢×‘×¨×ª ××©×™××•×ª ×‘×™×Ÿ ×¢×•×‘×“×™×

```javascript
// ×‘×“×©×‘×•×¨×“ (Frontend)
const result = await adminAPI.bulkTransferTasks({
  fromUserId: '×—×™×™×',
  toUserId: '×“× ×™'
});

console.log(`Transferred ${result.count} tasks`);
```

---

## ğŸ“Š Audit Log

×›×œ ×¤×¢×•×œ×” ××ª×•×¢×“×ª ××•×˜×•××˜×™×ª ×‘-collection `admin_audit_log`:

```javascript
{
  action: 'ADMIN_CREATE_USER',
  performedBy: 'haim@ghlawoffice.co.il',
  targetUser: 'employee@example.com',
  data: { role: 'employee', name: '×©× ×”×¢×•×‘×“' },
  timestamp: Timestamp,
  ipAddress: '1.2.3.4',
  success: true
}
```

---

## ğŸ› ï¸ ×¤×™×ª×•×— ×¢×ª×™×“×™

×¨×¢×™×•× ×•×ª ×œ×¤×™×¦'×¨×™× ×¢×ª×™×“×™×™×:

- [ ] **Reports & Analytics** - ×“×•×—×•×ª ×•×™×–×•××œ×™×™×
- [ ] **Bulk Operations** - ×¤×¢×•×œ×•×ª ××¨×•×‘×•×ª ×‘×‘×ª ××—×ª
- [ ] **Scheduled Tasks** - ××©×™××•×ª ××ª×•×–×× ×•×ª
- [ ] **Email Notifications** - ×”×ª×¨××•×ª ×‘××™×™×œ
- [ ] **Data Export** - ×™×™×¦×•× × ×ª×•× ×™× ×œ-CSV/Excel
- [ ] **Backup & Restore** - ×’×™×‘×•×™ ×•×©×—×–×•×¨

---

## ğŸ“ ×ª××™×›×”

×œ×©××œ×•×ª ××• ×‘×¢×™×•×ª:
- **××™×™×œ:** haim@ghlawoffice.co.il
- **×ª×™×¢×•×“ ××¤×•×¨×˜:** `admin-api/docs/`

---

## ğŸ“œ ×¨×™×©×™×•×Ÿ

Â© 2025 ××©×¨×“ ×¢×•"×“ ×’×™× ×”×¨×©×§×•×‘×™×¥ - ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª
