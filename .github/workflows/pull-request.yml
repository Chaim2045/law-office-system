# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Law Office Management System - Pull Request Validation
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ×ª×›×•× ×•×ª:
# âœ… Fast feedback ×¢×œ Pull Requests
# âœ… ×‘×“×™×§×•×ª ××™×›×•×ª ×§×•×“ ××•×˜×•××˜×™×•×ª
# âœ… TypeScript type checking
# âœ… Security scanning
# âœ… ×‘×“×™×§×” ×©×”×‘×™×œ×“ ×¢×•×‘×“
# âœ… ×œ×œ× deployment (×¨×§ ×‘×“×™×§×•×ª)
#
# ×’×¨×¡×”: 1.0.0
# ×ª××¨×™×š: 2025-11-03
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: ğŸ” Pull Request Validation

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Triggers - ××ª×™ ×”-workflow ×¨×¥
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
on:
  pull_request:
    # ×¨×¥ ×¢×œ ×›×œ PR ×©× ×¤×ª×— ×›× ×’×“ main
    branches: [main]
    # ×¨×¥ ×’× ×¢×œ ×¢×“×›×•× ×™× ×œ-PR ×§×™×™×
    types: [opened, synchronize, reopened]

  # ×™×“× ×™ trigger ×œ××§×¨×” ×©×¨×•×¦×™× ×œ×¨×•×¥ ×©×•×‘
  workflow_dispatch:

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Environment Variables - ××©×ª× ×™ ×¡×‘×™×‘×”
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
env:
  NODE_VERSION: '18'
  CACHE_KEY_PREFIX: 'law-office-v1'
  TZ: 'Asia/Jerusalem'

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Concurrency - ×‘×™×˜×•×œ runs ×™×©× ×™× ×›×©×™×© PR ×¢×“×›×•×Ÿ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
concurrency:
  # ×›×œ PR ××§×‘×œ group ××©×œ×•
  group: pr-${{ github.event.pull_request.number }}
  # ×‘×™×˜×•×œ runs ×™×©× ×™× ×× ×™×© push ×—×“×© ×œ-PR
  cancel-in-progress: true

jobs:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # JOB 1: PR Information
  # ××¦×™×’ ××™×“×¢ ×¢×œ ×”-PR
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  pr-info:
    name: ğŸ“‹ PR Information
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“Š Display PR Details
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“ Pull Request Information"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "PR Number: #${{ github.event.pull_request.number }}"
          echo "Title: ${{ github.event.pull_request.title }}"
          echo "Author: ${{ github.event.pull_request.user.login }}"
          echo "Base Branch: ${{ github.event.pull_request.base.ref }}"
          echo "Head Branch: ${{ github.event.pull_request.head.ref }}"
          echo "Changed Files: ${{ github.event.pull_request.changed_files }}"
          echo "Commits: ${{ github.event.pull_request.commits }}"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # JOB 2: Code Quality & Linting
  # ×‘×“×™×§×•×ª ××™×›×•×ª ×§×•×“
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  code-quality:
    name: ğŸ¨ Code Quality
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: ğŸ“¥ Checkout PR Code
        uses: actions/checkout@v4
        with:
          # Checkout the PR's head branch
          ref: ${{ github.event.pull_request.head.sha }}
          # Fetch full history for better diff analysis
          fetch-depth: 0

      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ Install Dependencies
        run: npm ci --prefer-offline --no-audit

      - name: ğŸ¨ Lint CSS Files
        run: npm run css:lint

      - name: ğŸ“Š Changed Files Statistics
        run: |
          echo "ğŸ“Š Files Changed in This PR:"
          git diff --name-only origin/${{ github.event.pull_request.base.ref }}...HEAD | head -20
          echo ""
          echo "Total files changed: $(git diff --name-only origin/${{ github.event.pull_request.base.ref }}...HEAD | wc -l)"

      - name: ğŸ” Check for New TODOs
        run: |
          echo "ğŸ” Checking for new TODO comments..."
          NEW_TODOS=$(git diff origin/${{ github.event.pull_request.base.ref }}...HEAD | grep -i "^+.*TODO\|^+.*FIXME\|^+.*XXX" | wc -l || echo "0")
          echo "ğŸ“ New TODO comments added: $NEW_TODOS"
          if [ "$NEW_TODOS" -gt 5 ]; then
            echo "âš ï¸ Warning: Many new TODOs added ($NEW_TODOS)"
            echo "Consider completing some before merging"
          fi

      - name: ğŸ“Š Code Statistics
        run: |
          echo "ğŸ“Š Code Statistics:"
          echo "JavaScript files: $(find apps/user-app/js -name '*.js' ! -path '*/node_modules/*' 2>/dev/null | wc -l)"
          echo "TypeScript files: $(find . -name '*.ts' ! -path '*/node_modules/*' 2>/dev/null | wc -l)"
          echo "CSS files: $(find apps/user-app/css -name '*.css' 2>/dev/null | wc -l)"
          echo "Total lines of code: $(find . -name '*.js' -o -name '*.ts' -o -name '*.css' ! -path '*/node_modules/*' 2>/dev/null | xargs wc -l 2>/dev/null | tail -1 || echo 'N/A')"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # JOB 3: TypeScript Validation
  # ×‘×“×™×§×ª TypeScript
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  typescript:
    name: ğŸ“˜ TypeScript Check
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: ğŸ“¥ Checkout PR Code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.sha }}

      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ Install Dependencies
        run: npm ci --prefer-offline --no-audit

      - name: ğŸ” TypeScript Type Check
        run: npm run type-check

      - name: ğŸ—ï¸ Compile TypeScript
        run: npm run compile-ts

      - name: âœ… TypeScript Validation Passed
        run: echo "âœ… All TypeScript files compiled successfully!"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # JOB 4: Security Audit
  # ×‘×“×™×§×•×ª ××‘×˜×—×”
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  security:
    name: ğŸ”’ Security Check
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: ğŸ“¥ Checkout PR Code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.sha }}

      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ”’ NPM Security Audit
        run: |
          echo "ğŸ” Running security audit..."
          npm audit --audit-level=moderate || {
            echo "âš ï¸ Security vulnerabilities found!"
            npm audit --audit-level=moderate --json > security-report.json 2>/dev/null || true
            echo "ğŸ“Š Check artifacts for detailed report"
            exit 1
          }

      - name: ğŸ” Scan for Exposed Secrets
        run: |
          echo "ğŸ” Scanning for exposed secrets in PR..."
          if git diff origin/${{ github.event.pull_request.base.ref }}...HEAD | grep -i "password\|secret\|apikey.*:.*['\"]AIza" 2>/dev/null; then
            echo "âš ï¸ Warning: Potential secrets detected in PR diff"
            echo "Please review and remove before merging!"
          else
            echo "âœ… No obvious secrets detected"
          fi

      - name: ğŸ“Š Upload Security Report
        uses: actions/upload-artifact@v4
        if: failure()
        with:
          name: security-report-pr-${{ github.event.pull_request.number }}
          path: security-report.json
          retention-days: 30

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # JOB 5: Automated Tests
  # ×”×¨×¦×ª ×‘×“×™×§×•×ª
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  test:
    name: ğŸ§ª Run Tests
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: ğŸ“¥ Checkout PR Code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.sha }}

      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ Install Dependencies
        run: npm ci --prefer-offline --no-audit

      - name: ğŸ§ª Run Tests
        run: npm test

      - name: ğŸ“Š Test Summary
        run: |
          echo "ğŸ“Š Test Execution Summary:"
          echo "âš ï¸ Note: Real tests not yet implemented"
          echo "TODO: Add Jest/Vitest unit tests"
          echo "TODO: Add E2E tests with Playwright/Cypress"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # JOB 6: Build Verification
  # ×•×™×“×•× ×©×”×¤×¨×•×™×§×˜ × ×‘× ×” ×‘×”×¦×œ×—×”
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  build:
    name: ğŸ—ï¸ Build Verification
    runs-on: ubuntu-latest
    needs: [code-quality, typescript, security]
    timeout-minutes: 15

    steps:
      - name: ğŸ“¥ Checkout PR Code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.sha }}

      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: ğŸ“¦ Install Dependencies
        run: npm ci --prefer-offline --no-audit

      - name: ğŸ—ï¸ Build TypeScript
        run: npm run compile-ts

      - name: âœ… Build Successful
        run: |
          echo "âœ… Build completed successfully!"
          echo "This PR is ready for code review"

      - name: ğŸ“Š Build Artifacts Info
        run: |
          echo "ğŸ“Š Build Output:"
          if [ -d "apps/user-app/dist" ]; then
            echo "Compiled files in dist/:"
            find apps/user-app/dist -type f | head -20
          else
            echo "No dist directory (expected for some configurations)"
          fi

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # JOB 7: Final Summary
  # ×¡×™×›×•× ×ª×•×¦××•×ª ×”×‘×“×™×§×•×ª
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  pr-summary:
    name: ğŸ“Š PR Validation Summary
    runs-on: ubuntu-latest
    needs: [pr-info, code-quality, typescript, security, test, build]
    if: always()
    timeout-minutes: 5

    steps:
      - name: âœ… All Checks Passed
        if: ${{ !contains(needs.*.result, 'failure') }}
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ… Pull Request Validation: SUCCESS"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "All checks passed successfully!"
          echo ""
          echo "âœ… Code Quality: Passed"
          echo "âœ… TypeScript: Passed"
          echo "âœ… Security: Passed"
          echo "âœ… Tests: Passed"
          echo "âœ… Build: Passed"
          echo ""
          echo "ğŸ‰ This PR is ready to merge!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      - name: âŒ Some Checks Failed
        if: ${{ contains(needs.*.result, 'failure') }}
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âŒ Pull Request Validation: FAILED"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "Some checks did not pass."
          echo ""
          echo "Code Quality: ${{ needs.code-quality.result }}"
          echo "TypeScript: ${{ needs.typescript.result }}"
          echo "Security: ${{ needs.security.result }}"
          echo "Tests: ${{ needs.test.result }}"
          echo "Build: ${{ needs.build.result }}"
          echo ""
          echo "âš ï¸ Please fix the failing checks before merging"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          exit 1

      - name: ğŸ“§ PR Status Comment
        run: |
          echo "ğŸ’¡ Tip: In the future, this can post a comment to the PR"
          echo "with detailed results using GitHub API or actions/github-script"
