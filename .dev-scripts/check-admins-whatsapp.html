<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>×‘×“×™×§×ª ×× ×”×œ×™ WhatsApp</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #f5f7fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2563eb;
            border-bottom: 3px solid #2563eb;
            padding-bottom: 15px;
        }
        .admin-card {
            background: #f9fafb;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-right: 4px solid #10b981;
        }
        .admin-card.error {
            border-right-color: #ef4444;
            background: #fee2e2;
        }
        .admin-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 10px;
        }
        .detail {
            margin: 8px 0;
            padding: 8px;
            background: white;
            border-radius: 4px;
        }
        .label {
            font-weight: bold;
            color: #6b7280;
            display: inline-block;
            width: 150px;
        }
        .value {
            color: #1f2937;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.9em;
            font-weight: bold;
        }
        .status.ok {
            background: #d1fae5;
            color: #065f46;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #1d4ed8;
        }
        .instructions {
            background: #dbeafe;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-right: 4px solid #3b82f6;
        }
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ×‘×“×™×§×ª ×× ×”×œ×™ WhatsApp Bot</h1>

        <div class="instructions">
            <strong>ğŸ“‹ ××” ×”×¡×§×¨×™×¤×˜ ×”×–×” ×¢×•×©×”:</strong><br><br>
            1. ×‘×•×“×§ ××ª ×›×œ ×”×× ×”×œ×™× ×‘××¢×¨×›×ª<br>
            2. ××¦×™×’ ××ª ×¤×¨×˜×™ ×”×˜×œ×¤×•×Ÿ ×•×”×’×“×¨×•×ª WhatsApp ×©×œ×”×<br>
            3. ×‘×•×“×§ ×× ×”×¤×•×¨××˜ × ×›×•×Ÿ (×—×™×™×‘ ×œ×”×™×•×ª +972XXXXXXXXX)<br>
            4. ××¦×™×’ ×× ×™×© ×‘×¢×™×•×ª ×©×¦×¨×™×š ×œ×ª×§×Ÿ
        </div>

        <button onclick="checkAdmins()">ğŸš€ ×‘×“×•×§ ×× ×”×œ×™×</button>
        <button onclick="clearResults()">ğŸ—‘ï¸ × ×§×”</button>

        <div id="results"></div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, query, where } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDxSXW6r1PU-OqZz8kJYVp6t92dvMXCJ3Q",
            authDomain: "law-office-system-e4801.firebaseapp.com",
            projectId: "law-office-system-e4801",
            storageBucket: "law-office-system-e4801.firebasestorage.app",
            messagingSenderId: "746166583616",
            appId: "1:746166583616:web:3a3c7098e0c3d3e8e80f60"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.clearResults = function() {
            document.getElementById('results').innerHTML = '';
        };

        window.checkAdmins = async function() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="spinner"></div>';

            try {
                // Query all admins
                const adminsQuery = query(
                    collection(db, 'employees'),
                    where('role', '==', 'admin')
                );

                const snapshot = await getDocs(adminsQuery);

                if (snapshot.empty) {
                    resultsDiv.innerHTML = '<div class="admin-card error"><strong>âŒ ×œ× × ××¦××• ×× ×”×œ×™× ×‘××¢×¨×›×ª!</strong></div>';
                    return;
                }

                let html = `<h2 style="margin-top: 30px;">ğŸ“Š × ××¦××• ${snapshot.size} ×× ×”×œ×™×</h2>`;

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const phone = data.phone || '';
                    const whatsappEnabled = data.whatsappEnabled || false;
                    const name = data.name || '×œ×œ× ×©×';
                    const email = data.email || '';

                    // Check phone format
                    const phoneOk = phone.startsWith('+972') && phone.length === 13;
                    const hasError = !phoneOk || !whatsappEnabled;

                    html += `
                        <div class="admin-card ${hasError ? 'error' : ''}">
                            <div class="admin-name">${name}</div>

                            <div class="detail">
                                <span class="label">ğŸ“§ Email:</span>
                                <span class="value">${email}</span>
                            </div>

                            <div class="detail">
                                <span class="label">ğŸ“± ×˜×œ×¤×•×Ÿ:</span>
                                <span class="value">${phone || 'âŒ ××™×Ÿ ××¡×¤×¨'}</span>
                                ${phoneOk
                                    ? '<span class="status ok">âœ… ×¤×•×¨××˜ ×ª×§×™×Ÿ</span>'
                                    : '<span class="status error">âŒ ×¤×•×¨××˜ ×©×’×•×™</span>'
                                }
                            </div>

                            <div class="detail">
                                <span class="label">ğŸ’¬ WhatsApp:</span>
                                ${whatsappEnabled
                                    ? '<span class="status ok">âœ… ××•×¤×¢×œ</span>'
                                    : '<span class="status error">âŒ ×œ× ××•×¤×¢×œ</span>'
                                }
                            </div>

                            ${!phoneOk ? `
                                <div style="margin-top: 15px; padding: 10px; background: #fef3c7; border-radius: 4px;">
                                    <strong>âš ï¸ ×‘×¢×™×”:</strong> ×”×¤×•×¨××˜ ×¦×¨×™×š ×œ×”×™×•×ª: <code>+972501234567</code><br>
                                    <strong>ğŸ’¡ ×ª×™×§×•×Ÿ:</strong> ×¢×¨×•×š ××ª ×”××©×ª××© ×‘××“××™×Ÿ ×¤×× ×œ ×•×©× ×” ××ª ×”××¡×¤×¨ ×œ×¤×•×¨××˜ ×”× ×›×•×Ÿ
                                </div>
                            ` : ''}

                            ${!whatsappEnabled ? `
                                <div style="margin-top: 15px; padding: 10px; background: #fef3c7; border-radius: 4px;">
                                    <strong>âš ï¸ ×‘×¢×™×”:</strong> WhatsApp ×œ× ××•×¤×¢×œ<br>
                                    <strong>ğŸ’¡ ×ª×™×§×•×Ÿ:</strong> ×¢×¨×•×š ××ª ×”××©×ª××© ×‘××“××™×Ÿ ×¤×× ×œ ×•×¡××Ÿ ××ª "WhatsApp ××•×¤×¢×œ"
                                </div>
                            ` : ''}
                        </div>
                    `;
                });

                // Summary
                const allOk = snapshot.docs.every(doc => {
                    const data = doc.data();
                    const phone = data.phone || '';
                    return phone.startsWith('+972') && phone.length === 13 && data.whatsappEnabled;
                });

                if (allOk) {
                    html += `
                        <div style="background: #d1fae5; padding: 20px; border-radius: 8px; margin-top: 20px; border-right: 4px solid #10b981;">
                            <strong>âœ… ×›×œ ×”×× ×”×œ×™× ××•×’×“×¨×™× × ×›×•×Ÿ!</strong><br><br>
                            ×¢×›×©×™×• ×›×œ ×× ×”×œ ×¦×¨×™×š:<br>
                            1. ×œ×©×œ×•×— WhatsApp ×œ-<code>+1 415 523 8886</code><br>
                            2. ×œ×›×ª×•×‘: <code>join [×§×•×“-sandbox]</code><br>
                            3. ×œ×›×ª×•×‘: <code>×¢×–×¨×”</code><br>
                            4. ×”×‘×•×˜ ×™×–×”×” ××•×ª× ×•×™×¦×™×’ ××ª ×”×ª×¤×¨×™×˜! ğŸ‰
                        </div>
                    `;
                } else {
                    html += `
                        <div style="background: #fee2e2; padding: 20px; border-radius: 8px; margin-top: 20px; border-right: 4px solid #ef4444;">
                            <strong>âŒ ×™×© ×‘×¢×™×•×ª ×©×¦×¨×™×š ×œ×ª×§×Ÿ!</strong><br><br>
                            ×ª×§×Ÿ ××ª ×”×‘×¢×™×•×ª ×”××¡×•×× ×•×ª ×œ××¢×œ×” ×•××– ×”×¨×¥ ×©×•×‘ ××ª ×”×‘×“×™×§×”.
                        </div>
                    `;
                }

                resultsDiv.innerHTML = html;

            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="admin-card error">
                        <strong>âŒ ×©×’×™××”:</strong> ${error.message}
                    </div>
                `;
                console.error(error);
            }
        };
    </script>
</body>
</html>
