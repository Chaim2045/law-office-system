<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×“×™×§×ª ×¦'××˜ - ×“×™××’× ×•×¡×˜×™×§×” ××œ××”</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .instructions {
            background: #f0f4ff;
            border-right: 4px solid #667eea;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .instructions h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .instructions ol {
            margin-right: 20px;
            line-height: 1.8;
        }

        .instructions li {
            margin-bottom: 10px;
        }

        .test-section {
            margin-bottom: 30px;
        }

        .test-section h3 {
            color: #764ba2;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            width: 100%;
            margin-bottom: 20px;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .test-button:active {
            transform: translateY(0);
        }

        .result-box {
            background: #f9f9f9;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .result-box.success {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .result-box.error {
            background: #ffebee;
            border-color: #f44336;
        }

        .result-box.warning {
            background: #fff8e1;
            border-color: #ff9800;
        }

        .status-icon {
            display: inline-block;
            margin-left: 10px;
            font-size: 18px;
        }

        .check-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            background: white;
            border-right: 3px solid #e0e0e0;
        }

        .check-item.pass {
            border-right-color: #4caf50;
        }

        .check-item.fail {
            border-right-color: #f44336;
        }

        .footer {
            text-align: center;
            color: #999;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ×‘×“×™×§×ª ××¢×¨×›×ª ×”×¦'××˜</h1>
        <p class="subtitle">×“×™××’× ×•×¡×˜×™×§×” ××œ××” - Admin Panel Chat System</p>

        <div class="instructions">
            <h3>ğŸ“‹ ×”×•×¨××•×ª ×©×™××•×©:</h3>
            <ol>
                <li><strong>×¤×ª×— ××ª ×”-Admin Panel</strong> ×‘×˜××‘ ××—×¨</li>
                <li><strong>×”×ª×—×‘×¨</strong> ×¢× ×”××©×ª××© admin</li>
                <li><strong>×¤×ª×— ×¤×¨×˜×™ ×¢×•×‘×“</strong> (×œ×—×¥ ×¢×œ ×¢×•×‘×“ ×›×œ×©×”×• ××”×¨×©×™××”)</li>
                <li><strong>×œ×—×¥ ×¢×œ ×”×˜××‘ "×¦'××˜"</strong> (×—×©×•×‘!)</li>
                <li><strong>×—×–×•×¨ ×œ×›××Ÿ</strong> ×•×œ×—×¥ ×¢×œ ×”×›×¤×ª×•×¨×™× ×œ××˜×”</li>
            </ol>
        </div>

        <div class="test-section">
            <h3>1ï¸âƒ£ ×‘×“×™×§×ª ××‘× ×” ×‘×¡×™×¡×™</h3>
            <button class="test-button" onclick="testBasicStructure()">
                ğŸ” ×‘×“×•×§ ××‘× ×” ×‘×¡×™×¡×™
            </button>
            <div id="basicResult"></div>
        </div>

        <div class="test-section">
            <h3>2ï¸âƒ£ ×‘×“×™×§×ª Modal ×•-UserData</h3>
            <button class="test-button" onclick="testModalData()">
                ğŸ‘¤ ×‘×“×•×§ × ×ª×•× ×™ ××©×ª××© ×‘××•×“×œ
            </button>
            <div id="modalResult"></div>
        </div>

        <div class="test-section">
            <h3>3ï¸âƒ£ ×‘×“×™×§×ª Conversation ID</h3>
            <button class="test-button" onclick="testConversationId()">
                ğŸ’¬ ×‘×“×•×§ ××–×”×” ×©×™×—×”
            </button>
            <div id="conversationResult"></div>
        </div>

        <div class="test-section">
            <h3>4ï¸âƒ£ ×‘×“×™×§×ª Chat UI</h3>
            <button class="test-button" onclick="testChatUI()">
                ğŸ¨ ×‘×“×•×§ ×××©×§ ×”×¦'××˜
            </button>
            <div id="uiResult"></div>
        </div>

        <div class="test-section">
            <h3>5ï¸âƒ£ ×‘×“×™×§×” ××œ××” - ALL IN ONE</h3>
            <button class="test-button" onclick="runFullDiagnostic()">
                ğŸš€ ×”×¨×¥ ×‘×“×™×§×” ××œ××”
            </button>
            <div id="fullResult"></div>
        </div>

        <div class="footer">
            <p>× ×•×¦×¨ ×¢×‘×•×¨ ××¢×¨×›×ª × ×™×”×•×œ ××©×¨×“ ×¢×•"×“ | ×’×¨×¡×” 1.0.0</p>
        </div>
    </div>

    <script>
        // Get the admin panel window (assumes it's already open)
        function getAdminWindow() {
            // Try to find the admin panel window
            // User should have it open in another tab
            return window.opener || window;
        }

        function testBasicStructure() {
            const resultDiv = document.getElementById('basicResult');
            const checks = [];

            try {
                // Try to access via window.open reference or same origin
                const adminWin = getAdminWindow();

                // Test Firebase
                checks.push({
                    test: 'Firebase SDK',
                    pass: typeof firebase !== 'undefined',
                    details: typeof firebase !== 'undefined' ? 'Firebase ×–××™×Ÿ' : 'Firebase ×œ× ×–××™×Ÿ'
                });

                // Test ChatManager
                checks.push({
                    test: 'ChatManager Class',
                    pass: typeof window.ChatManager !== 'undefined',
                    details: typeof window.ChatManager !== 'undefined' ? 'ChatManager ×–××™×Ÿ' : 'ChatManager ×œ× × ××¦×'
                });

                // Test chatManager instance
                checks.push({
                    test: 'chatManager Instance',
                    pass: typeof window.chatManager !== 'undefined',
                    details: typeof window.chatManager !== 'undefined' ? 'chatManager ×××•×ª×—×œ' : 'chatManager ×œ× ×××•×ª×—×œ'
                });

                // Test ModalManager
                checks.push({
                    test: 'ModalManager',
                    pass: typeof window.ModalManager !== 'undefined',
                    details: typeof window.ModalManager !== 'undefined' ? 'ModalManager ×–××™×Ÿ' : 'ModalManager ×œ× × ××¦×'
                });

                displayResults(resultDiv, checks);

            } catch (error) {
                resultDiv.innerHTML = `<div class="result-box error">âŒ ×©×’×™××”: ${error.message}</div>`;
            }
        }

        function testModalData() {
            const resultDiv = document.getElementById('modalResult');
            const checks = [];

            try {
                if (!window.ModalManager || !window.ModalManager.modals) {
                    throw new Error('ModalManager ×œ× ×–××™×Ÿ. ×•×•×“× ×©×¤×ª×—×ª ××ª ×”-Admin Panel');
                }

                const modalIds = Object.keys(window.ModalManager.modals);

                checks.push({
                    test: '××•×“×œ×™× ×¤×¢×™×œ×™×',
                    pass: modalIds.length > 0,
                    details: `× ××¦××• ${modalIds.length} ××•×“×œ×™× ×¤×¢×™×œ×™×`
                });

                if (modalIds.length === 0) {
                    throw new Error('××™×Ÿ ××•×“×œ×™× ×¤×¢×™×œ×™×. ×¤×ª×— ×¤×¨×˜×™ ×¢×•×‘×“ ×‘-Admin Panel');
                }

                const modal = window.ModalManager.modals[modalIds[0]];

                checks.push({
                    test: 'Modal Instance',
                    pass: !!modal,
                    details: modal ? 'Modal ×§×™×™×' : 'Modal ×œ× × ××¦×'
                });

                checks.push({
                    test: 'currentUser',
                    pass: !!modal.currentUser,
                    details: modal.currentUser ? `UID: ${modal.currentUser.uid}` : 'currentUser ×œ× ×§×™×™×'
                });

                checks.push({
                    test: 'userData',
                    pass: !!modal.userData,
                    details: modal.userData ? 'userData ×§×™×™×' : 'userData ×œ× ×§×™×™×'
                });

                if (modal.userData) {
                    checks.push({
                        test: 'userData.uid',
                        pass: !!modal.userData.uid,
                        details: modal.userData.uid ? `UID: ${modal.userData.uid}` : 'âŒ UID ×—×¡×¨!'
                    });

                    checks.push({
                        test: 'userData.authUID',
                        pass: !!modal.userData.authUID,
                        details: modal.userData.authUID ? `authUID: ${modal.userData.authUID}` : 'authUID ×œ× ×§×™×™×'
                    });

                    checks.push({
                        test: 'userData.email',
                        pass: !!modal.userData.email,
                        details: modal.userData.email || '××™××™×™×œ ×œ× ×§×™×™×'
                    });

                    checks.push({
                        test: 'userData.displayName',
                        pass: !!modal.userData.displayName,
                        details: modal.userData.displayName || '×©× ×œ× ×§×™×™×'
                    });
                }

                displayResults(resultDiv, checks, {
                    currentUser: modal.currentUser,
                    userData: modal.userData
                });

            } catch (error) {
                resultDiv.innerHTML = `<div class="result-box error">âŒ ×©×’×™××”: ${error.message}</div>`;
            }
        }

        function testConversationId() {
            const resultDiv = document.getElementById('conversationResult');
            const checks = [];

            try {
                if (!window.chatManager) {
                    throw new Error('chatManager ×œ× ×–××™×Ÿ');
                }

                if (!window.ModalManager || !window.ModalManager.modals) {
                    throw new Error('ModalManager ×œ× ×–××™×Ÿ');
                }

                const modalIds = Object.keys(window.ModalManager.modals);
                if (modalIds.length === 0) {
                    throw new Error('××™×Ÿ ××•×“×œ×™× ×¤×¢×™×œ×™×');
                }

                const modal = window.ModalManager.modals[modalIds[0]];
                const adminUid = window.firebaseAuth?.currentUser?.uid;
                const employeeUid = modal.userData?.uid;

                checks.push({
                    test: 'Admin UID',
                    pass: !!adminUid,
                    details: adminUid || 'âŒ ×—×¡×¨'
                });

                checks.push({
                    test: 'Employee UID',
                    pass: !!employeeUid,
                    details: employeeUid || 'âŒ ×—×¡×¨'
                });

                if (adminUid && employeeUid) {
                    const conversationId = window.chatManager.getConversationId(adminUid, employeeUid);

                    checks.push({
                        test: 'Conversation ID',
                        pass: conversationId && !conversationId.includes('undefined'),
                        details: conversationId
                    });

                    checks.push({
                        test: 'Format ×ª×§×™×Ÿ',
                        pass: /^conv_[^_]+_[^_]+$/.test(conversationId) && !conversationId.includes('undefined'),
                        details: /^conv_[^_]+_[^_]+$/.test(conversationId) ? 'âœ… ×ª×§×™×Ÿ' : 'âŒ ×œ× ×ª×§×™×Ÿ'
                    });
                }

                displayResults(resultDiv, checks, {
                    adminUid,
                    employeeUid,
                    conversationId: adminUid && employeeUid ? window.chatManager.getConversationId(adminUid, employeeUid) : 'N/A'
                });

            } catch (error) {
                resultDiv.innerHTML = `<div class="result-box error">âŒ ×©×’×™××”: ${error.message}</div>`;
            }
        }

        function testChatUI() {
            const resultDiv = document.getElementById('uiResult');
            const checks = [];

            try {
                if (!window.ModalManager || !window.ModalManager.modals) {
                    throw new Error('ModalManager ×œ× ×–××™×Ÿ');
                }

                const modalIds = Object.keys(window.ModalManager.modals);
                if (modalIds.length === 0) {
                    throw new Error('××™×Ÿ ××•×“×œ×™× ×¤×¢×™×œ×™×');
                }

                const modal = window.ModalManager.modals[modalIds[0]];

                // Check if modal has renderChatTab method
                checks.push({
                    test: 'renderChatTab Method',
                    pass: typeof modal.renderChatTab === 'function',
                    details: typeof modal.renderChatTab === 'function' ? '×”××ª×•×“×” ×§×™×™××ª' : '×”××ª×•×“×” ×œ× × ××¦××”'
                });

                // Check if chat tab exists in DOM
                const chatTab = document.querySelector('.tab-chat');
                checks.push({
                    test: 'Chat Tab ×‘DOM',
                    pass: !!chatTab,
                    details: chatTab ? '×˜××‘ ×”×¦\'××˜ ×§×™×™× ×‘×“×£' : '×˜××‘ ×”×¦\'××˜ ×œ× × ××¦× (×”×× ×œ×—×¦×ª ×¢×œ ×”×˜××‘?)'
                });

                if (chatTab) {
                    const chatContainer = chatTab.querySelector('.modal-chat-messages');
                    checks.push({
                        test: 'Chat Messages Container',
                        pass: !!chatContainer,
                        details: chatContainer ? '×§×•× ×˜×™×™× ×¨ ×”×”×•×“×¢×•×ª ×§×™×™×' : '×§×•× ×˜×™×™× ×¨ ×”×”×•×“×¢×•×ª ×œ× × ××¦×'
                    });

                    const chatInput = chatTab.querySelector('.modal-chat-input');
                    checks.push({
                        test: 'Chat Input',
                        pass: !!chatInput,
                        details: chatInput ? '×©×“×” ×§×œ×˜ ×§×™×™×' : '×©×“×” ×§×œ×˜ ×œ× × ××¦×'
                    });

                    const sendButton = chatTab.querySelector('.modal-chat-send-btn');
                    checks.push({
                        test: 'Send Button',
                        pass: !!sendButton,
                        details: sendButton ? '×›×¤×ª×•×¨ ×©×œ×™×—×” ×§×™×™×' : '×›×¤×ª×•×¨ ×©×œ×™×—×” ×œ× × ××¦×'
                    });
                }

                // Check if chat listener is active
                checks.push({
                    test: 'Chat Listener',
                    pass: !!modal.chatListener,
                    details: modal.chatListener ? '×”×××–×™×Ÿ ×¤×¢×™×œ' : '×”×××–×™×Ÿ ×œ× ×¤×¢×™×œ'
                });

                displayResults(resultDiv, checks);

            } catch (error) {
                resultDiv.innerHTML = `<div class="result-box error">âŒ ×©×’×™××”: ${error.message}</div>`;
            }
        }

        function runFullDiagnostic() {
            const resultDiv = document.getElementById('fullResult');
            let output = '';

            try {
                output += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
                output += 'ğŸš€ ×‘×“×™×§×” ××œ××” - Full Diagnostic Report\n';
                output += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';

                // 1. Firebase
                output += '1ï¸âƒ£ FIREBASE:\n';
                output += `   â€¢ Firebase SDK: ${typeof firebase !== 'undefined' ? 'âœ…' : 'âŒ'}\n`;
                output += `   â€¢ Auth: ${typeof window.firebaseAuth !== 'undefined' ? 'âœ…' : 'âŒ'}\n`;
                output += `   â€¢ Firestore: ${typeof window.firebaseDB !== 'undefined' ? 'âœ…' : 'âŒ'}\n`;
                if (window.firebaseAuth?.currentUser) {
                    output += `   â€¢ Current User: ${window.firebaseAuth.currentUser.email}\n`;
                    output += `   â€¢ User UID: ${window.firebaseAuth.currentUser.uid}\n`;
                }
                output += '\n';

                // 2. Chat System
                output += '2ï¸âƒ£ CHAT SYSTEM:\n';
                output += `   â€¢ ChatManager Class: ${typeof window.ChatManager !== 'undefined' ? 'âœ…' : 'âŒ'}\n`;
                output += `   â€¢ chatManager Instance: ${typeof window.chatManager !== 'undefined' ? 'âœ…' : 'âŒ'}\n`;
                if (window.chatManager) {
                    output += `   â€¢ Chat Enabled: ${window.chatManager.CHAT_ENABLED ? 'âœ…' : 'âŒ'}\n`;
                    output += `   â€¢ Active Listeners: ${window.chatManager.activeListeners?.size || 0}\n`;
                }
                output += '\n';

                // 3. Modal System
                output += '3ï¸âƒ£ MODAL SYSTEM:\n';
                output += `   â€¢ ModalManager: ${typeof window.ModalManager !== 'undefined' ? 'âœ…' : 'âŒ'}\n`;
                if (window.ModalManager?.modals) {
                    const modalIds = Object.keys(window.ModalManager.modals);
                    output += `   â€¢ Active Modals: ${modalIds.length}\n`;

                    if (modalIds.length > 0) {
                        const modal = window.ModalManager.modals[modalIds[0]];
                        output += `   â€¢ Modal Type: ${modal.constructor.name}\n`;
                        output += `   â€¢ renderChatTab: ${typeof modal.renderChatTab === 'function' ? 'âœ…' : 'âŒ'}\n`;

                        if (modal.currentUser) {
                            output += `\n   ğŸ“‹ currentUser:\n`;
                            output += `      â€¢ uid: ${modal.currentUser.uid}\n`;
                            output += `      â€¢ email: ${modal.currentUser.email || 'N/A'}\n`;
                        }

                        if (modal.userData) {
                            output += `\n   ğŸ“‹ userData:\n`;
                            output += `      â€¢ uid: ${modal.userData.uid || 'âŒ MISSING'}\n`;
                            output += `      â€¢ authUID: ${modal.userData.authUID || 'N/A'}\n`;
                            output += `      â€¢ email: ${modal.userData.email || 'N/A'}\n`;
                            output += `      â€¢ displayName: ${modal.userData.displayName || 'N/A'}\n`;
                        }

                        output += `\n   ğŸ¯ Chat Listener: ${modal.chatListener ? 'âœ… ×¤×¢×™×œ' : 'âŒ ×œ× ×¤×¢×™×œ'}\n`;
                    }
                }
                output += '\n';

                // 4. Conversation ID
                output += '4ï¸âƒ£ CONVERSATION ID:\n';
                if (window.chatManager && window.ModalManager?.modals) {
                    const modalIds = Object.keys(window.ModalManager.modals);
                    if (modalIds.length > 0) {
                        const modal = window.ModalManager.modals[modalIds[0]];
                        const adminUid = window.firebaseAuth?.currentUser?.uid;
                        const employeeUid = modal.userData?.uid;

                        output += `   â€¢ Admin UID: ${adminUid || 'âŒ MISSING'}\n`;
                        output += `   â€¢ Employee UID: ${employeeUid || 'âŒ MISSING'}\n`;

                        if (adminUid && employeeUid) {
                            const convId = window.chatManager.getConversationId(adminUid, employeeUid);
                            output += `   â€¢ Conversation ID: ${convId}\n`;
                            output += `   â€¢ Contains 'undefined': ${convId.includes('undefined') ? 'âŒ YES - BUG!' : 'âœ… NO'}\n`;
                        } else {
                            output += `   âš ï¸ ×œ× × ×™×ª×Ÿ ×œ×—×©×‘ Conversation ID - ×—×¡×¨×™× UIDs\n`;
                        }
                    }
                }
                output += '\n';

                // 5. DOM Elements
                output += '5ï¸âƒ£ DOM ELEMENTS:\n';
                const chatTab = document.querySelector('.tab-chat');
                output += `   â€¢ Chat Tab: ${chatTab ? 'âœ…' : 'âŒ (×œ×—×¥ ×¢×œ ×˜××‘ ×”×¦\'××˜!)'}\n`;
                if (chatTab) {
                    output += `   â€¢ Messages Container: ${chatTab.querySelector('.modal-chat-messages') ? 'âœ…' : 'âŒ'}\n`;
                    output += `   â€¢ Input Field: ${chatTab.querySelector('.modal-chat-input') ? 'âœ…' : 'âŒ'}\n`;
                    output += `   â€¢ Send Button: ${chatTab.querySelector('.modal-chat-send-btn') ? 'âœ…' : 'âŒ'}\n`;
                }
                output += '\n';

                // 6. Summary
                output += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
                output += 'ğŸ“Š SUMMARY:\n';
                output += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';

                const allGood =
                    typeof firebase !== 'undefined' &&
                    typeof window.chatManager !== 'undefined' &&
                    window.ModalManager?.modals &&
                    Object.keys(window.ModalManager.modals).length > 0;

                if (allGood) {
                    const modal = window.ModalManager.modals[Object.keys(window.ModalManager.modals)[0]];
                    const hasUid = modal.userData?.uid;

                    if (hasUid && !hasUid.includes('undefined')) {
                        output += 'âœ… ×”×›×œ ×ª×§×™×Ÿ! ×”××¢×¨×›×ª ××•×›× ×” ×œ×©×™××•×©.\n';
                        output += '\nğŸ’¡ ×›×¢×ª × ×¡×” ×œ×©×œ×•×— ×”×•×“×¢×” ×‘×¦\'××˜.\n';
                    } else {
                        output += 'âŒ ×‘×¢×™×”: userData.uid ×—×¡×¨ ××• ××›×™×œ undefined\n';
                        output += '\nğŸ”§ ×¤×ª×¨×•×Ÿ:\n';
                        output += '   1. ×¡×’×•×¨ ××ª ×”××•×“×œ\n';
                        output += '   2. ×¢×©×” Ctrl+Shift+R (hard refresh)\n';
                        output += '   3. ×¤×ª×— ×©×•×‘ ×¤×¨×˜×™ ×¢×•×‘×“\n';
                        output += '   4. ×œ×—×¥ ×¢×œ ×˜××‘ ×¦\'××˜\n';
                        output += '   5. ×”×¨×¥ ×©×•×‘ ××ª ×”×‘×“×™×§×”\n';
                    }
                } else {
                    output += 'âš ï¸ ×—×¡×¨×™× ×¨×›×™×‘×™×:\n';
                    if (typeof firebase === 'undefined') output += '   â€¢ Firebase ×œ× ×˜×¢×•×Ÿ\n';
                    if (typeof window.chatManager === 'undefined') output += '   â€¢ ChatManager ×œ× ×××•×ª×—×œ\n';
                    if (!window.ModalManager?.modals || Object.keys(window.ModalManager.modals).length === 0) {
                        output += '   â€¢ ××™×Ÿ ××•×“×œ×™× ×¤×¢×™×œ×™× (×¤×ª×— ×¤×¨×˜×™ ×¢×•×‘×“!)\n';
                    }
                }

                resultDiv.innerHTML = `<div class="result-box">${output}</div>`;

            } catch (error) {
                resultDiv.innerHTML = `<div class="result-box error">âŒ ×©×’×™××” ×—××•×¨×”:\n\n${error.message}\n\n${error.stack}</div>`;
            }
        }

        function displayResults(container, checks, additionalData = null) {
            let html = '<div class="result-box">';

            checks.forEach(check => {
                const icon = check.pass ? 'âœ…' : 'âŒ';
                const className = check.pass ? 'pass' : 'fail';
                html += `
                    <div class="check-item ${className}">
                        <strong>${icon} ${check.test}:</strong> ${check.details}
                    </div>
                `;
            });

            if (additionalData) {
                html += '<hr style="margin: 20px 0; border: none; border-top: 1px solid #e0e0e0;">';
                html += '<strong>ğŸ“‹ × ×ª×•× ×™× × ×•×¡×¤×™×:</strong><br><br>';
                html += '<pre style="background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto;">';
                html += JSON.stringify(additionalData, null, 2);
                html += '</pre>';
            }

            html += '</div>';
            container.innerHTML = html;
        }

        // Show welcome message
        console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                 ğŸ” ××¢×¨×›×ª ×‘×“×™×§×ª ×¦'××˜                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  ×‘×¨×•×š ×”×‘× ×œ××¢×¨×›×ª ×”×“×™××’× ×•×¡×˜×™×§×” ×©×œ Chat System                â•‘
â•‘                                                               â•‘
â•‘  ×”×©×ª××© ×‘×›×¤×ª×•×¨×™× ×‘×¢××•×“ ×›×“×™ ×œ×‘×“×•×§ ××ª ×ª×§×™× ×•×ª ×”××¢×¨×›×ª            â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        `);
    </script>
</body>
</html>
