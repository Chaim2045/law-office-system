<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification System Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-item {
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #ddd;
            padding-left: 15px;
        }
        .test-item.success {
            border-color: #4caf50;
            background: #f1f8f4;
        }
        .test-item.error {
            border-color: #f44336;
            background: #fef1f0;
        }
        .test-item.warning {
            border-color: #ff9800;
            background: #fff8f0;
        }
        h1 { color: #333; }
        h2 { color: #666; margin-top: 30px; }
        .icon { margin-right: 10px; }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Notification System Test Results</h1>

    <div class="test-section">
        <h2>ğŸ“Š Pre-Flight Checks</h2>
        <div id="preFlightResults"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ¯ Element Validation</h2>
        <div id="elementResults"></div>
    </div>

    <div class="test-section">
        <h2>âš™ï¸ Functionality Tests</h2>
        <div id="functionalityResults"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“ Manual Tests Checklist</h2>
        <div class="test-item">
            <input type="checkbox" id="test1">
            <label for="test1">×¤×ª×— ××ª index.html ×‘×“×¤×“×¤×Ÿ</label>
        </div>
        <div class="test-item">
            <input type="checkbox" id="test2">
            <label for="test2">× ×§×” cache (Ctrl+Shift+R)</label>
        </div>
        <div class="test-item">
            <input type="checkbox" id="test3">
            <label for="test3">×”×ª×—×‘×¨ ×œ××¢×¨×›×ª</label>
        </div>
        <div class="test-item">
            <input type="checkbox" id="test4">
            <label for="test4">×œ×—×¥ ×¢×œ ×”××¢×˜×¤×” ğŸ“§ - dropdown × ×¤×ª×—</label>
        </div>
        <div class="test-item">
            <input type="checkbox" id="test5">
            <label for="test5">×‘×“×•×§ ×©××™×Ÿ ×©×’×™××•×ª ×‘-Console</label>
        </div>
        <div class="test-item">
            <input type="checkbox" id="test6">
            <label for="test6">×× ×™×© ×”×•×“×¢×•×ª - ×¡××Ÿ ×›× ×§×¨× (X)</label>
        </div>
        <div class="test-item">
            <input type="checkbox" id="test7">
            <label for="test7">×¨×¢× ×Ÿ ×“×£ (F5) - ×”×•×“×¢×” ×œ× ×—×•×–×¨×ª</label>
        </div>
        <div class="test-item">
            <input type="checkbox" id="test8">
            <label for="test8">×‘×§×© ×××“××™×Ÿ ×œ×©×œ×•×— ×”×•×“×¢×” ×—×“×©×”</label>
        </div>
        <div class="test-item">
            <input type="checkbox" id="test9">
            <label for="test9">×•×•×“× ×©×”×”×•×“×¢×” ××•×¤×™×¢×” ×‘×–××Ÿ ×××ª</label>
        </div>
        <div class="test-item">
            <input type="checkbox" id="test10">
            <label for="test10">×‘×“×•×§ ×©×”×‘××“×’' ××ª×¢×“×›×Ÿ</label>
        </div>
    </div>

    <script>
        // Run automated tests
        window.addEventListener('DOMContentLoaded', () => {
            runPreFlightTests();
            runElementTests();
            runFunctionalityTests();
        });

        function runPreFlightTests() {
            const results = document.getElementById('preFlightResults');
            const tests = [];

            // Test 1: Check if old files are deleted
            fetch('js/managers/UserAlertsPanel.js')
                .then(response => {
                    if (response.status === 404) {
                        tests.push(createTestItem('success', 'âœ… UserAlertsPanel.js deleted'));
                    } else {
                        tests.push(createTestItem('error', 'âŒ UserAlertsPanel.js still exists!'));
                    }
                })
                .catch(() => {
                    tests.push(createTestItem('success', 'âœ… UserAlertsPanel.js deleted'));
                })
                .finally(() => updateResults(results, tests));

            fetch('js/init-user-alerts.js')
                .then(response => {
                    if (response.status === 404) {
                        tests.push(createTestItem('success', 'âœ… init-user-alerts.js deleted'));
                    } else {
                        tests.push(createTestItem('error', 'âŒ init-user-alerts.js still exists!'));
                    }
                })
                .catch(() => {
                    tests.push(createTestItem('success', 'âœ… init-user-alerts.js deleted'));
                })
                .finally(() => updateResults(results, tests));

            // Test 2: Check if NotificationBell exists
            fetch('js/modules/notification-bell.js')
                .then(response => {
                    if (response.ok) {
                        tests.push(createTestItem('success', 'âœ… notification-bell.js exists'));
                    } else {
                        tests.push(createTestItem('error', 'âŒ notification-bell.js missing!'));
                    }
                })
                .finally(() => updateResults(results, tests));
        }

        function runElementTests() {
            const results = document.getElementById('elementResults');
            const tests = [];

            // Load index.html and check elements
            fetch('index.html')
                .then(response => response.text())
                .then(html => {
                    // Check for messagesIcon
                    if (html.includes('id="messagesIcon"')) {
                        tests.push(createTestItem('success', 'âœ… messagesIcon element found'));
                    } else {
                        tests.push(createTestItem('error', 'âŒ messagesIcon element missing!'));
                    }

                    // Check for messagesCountBadge
                    if (html.includes('id="messagesCountBadge"')) {
                        tests.push(createTestItem('success', 'âœ… messagesCountBadge element found'));
                    } else {
                        tests.push(createTestItem('error', 'âŒ messagesCountBadge element missing!'));
                    }

                    // Check for notificationsDropdown
                    if (html.includes('id="notificationsDropdown"')) {
                        tests.push(createTestItem('success', 'âœ… notificationsDropdown element found'));
                    } else {
                        tests.push(createTestItem('error', 'âŒ notificationsDropdown element missing!'));
                    }

                    // Check for correct onclick
                    if (html.includes('window.notificationBell') && html.includes('toggleDropdown')) {
                        tests.push(createTestItem('success', 'âœ… Correct onclick handler (notificationBell.toggleDropdown)'));
                    } else {
                        tests.push(createTestItem('error', 'âŒ Incorrect onclick handler!'));
                    }

                    // Check that userAlertsPanel is NOT referenced
                    if (!html.includes('userAlertsPanel')) {
                        tests.push(createTestItem('success', 'âœ… No userAlertsPanel references in HTML'));
                    } else {
                        tests.push(createTestItem('warning', 'âš ï¸ Found userAlertsPanel references in HTML!'));
                    }

                    updateResults(results, tests);
                });
        }

        function runFunctionalityTests() {
            const results = document.getElementById('functionalityResults');
            const tests = [];

            tests.push(createTestItem('warning', 'âš ï¸ Functionality tests require running the app'));
            tests.push(createTestItem('warning', 'â„¹ï¸ Please complete the manual checklist below'));

            updateResults(results, tests);
        }

        function createTestItem(type, text) {
            return `<div class="test-item ${type}">${text}</div>`;
        }

        function updateResults(container, tests) {
            container.innerHTML = tests.join('');
        }
    </script>
</body>
</html>
